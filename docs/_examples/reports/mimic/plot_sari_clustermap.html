

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SARI - Antibiogram (clustered) &mdash; pyamr 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="SARI - Antibiogram" href="plot_sari_heatmap.html" />
    <link rel="prev" title="HTML - Treemap (sari)" href="plot_mimic_treemap.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> pyamr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/registries.html">Registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/todo.html">Future Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Galleries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/index.html">Examples with indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../forecasting/index.html">Examples with TSA</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Reports</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#mimic-critical-care">MIMIC Critical Care</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_describe.html">Describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_mimic_treemap.html">HTML - Treemap (sari)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SARI - Antibiogram (clustered)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_heatmap.html">SARI - Antibiogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_relmap.html">SARI - Antibiogram (relmap)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_spectrum_gramtype.html">SART - Spectrum (gram type)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_spectrum_multiple.html">SART - Spectrum (multiple)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#imperial-college-nhs-trust">Imperial College NHS Trust</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization/index.html">Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_apidoc/modules.html">pyamr</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyamr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Reports</a> &raquo;</li>
        
      <li>SARI - Antibiogram (clustered)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/_examples/reports/mimic/plot_sari_clustermap.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-reports-mimic-plot-sari-clustermap-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="sari-antibiogram-clustered">
<span id="sphx-glr-examples-reports-mimic-plot-sari-clustermap-py"></span><h1>SARI - Antibiogram (clustered)<a class="headerlink" href="#sari-antibiogram-clustered" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Explain and Simplify</p>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Antibiogram (clustered) - ABSCESS" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0011.png" />
</li>
<li><img alt="Antibiogram (clustered) - BLOOD CULTURE" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0021.png" />
</li>
<li><img alt="Antibiogram (clustered) - SWAB" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0031.png" />
</li>
<li><img alt="Antibiogram (clustered) - Staph aureus Screen" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0041.png" />
</li>
<li><img alt="Antibiogram (clustered) - URINE" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0051.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SARI (overall):
sensitivity                                               P  intermediate  resistant  sensitive  freq    sari
specimen_code microorganism_name    antimicrobial_name
ABSCESS       Achromobacter species Cefepime            0.0           0.0        1.0        0.0   1.0  1.0000
                                    Ceftazidime         0.0           1.0        0.0        0.0   1.0  1.0000
                                    Ceftriaxone         0.0           0.0        1.0        0.0   1.0  1.0000
                                    Ciprofloxacin       0.0           0.0        0.0        1.0   1.0  0.0000
                                    Gentamicin          0.0           1.0        0.0        0.0   1.0  1.0000
...                                                     ...           ...        ...        ...   ...     ...
URINE         Viridans streptococci Clindamycin         0.0           2.0        0.0        8.0  10.0  0.2000
                                    Erythromycin        0.0           0.0        4.0        6.0  10.0  0.4000
                                    Levofloxacin        0.0           0.0        0.0        1.0   1.0  0.0000
                                    Penicillin g        0.0           2.0        0.0        9.0  11.0  0.1818
                                    Vancomycin          0.0           0.0        0.0       11.0  11.0  0.0000

[4307 rows x 6 columns]



Data (ABSCESS)
antimicrobial_name                               Amikacin    Ceftazidime    Ceftriaxone     Cefuroxime    Ciprofloxacin  ...  Meropenem   Oxacillin  Tetracycline      Tobramycin   Vancomycin
category                                  Aminoglycosides Cephalosporins Cephalosporins Cephalosporins Fluoroquinolones  ... Meropenems Penicillins Tetracyclines Aminoglycosides Glycopeptide
microorganism_name          genus                                                                                        ...
Achromobacter species       Achromobacter               0            100            100              0                0  ...        100           0             0               0            0
Acinetobacter baumannii     Acinetobacter               0              0              0              0                0  ...          0           0             0               0            0
Actinomyces israelii        Actinomyces                 0              0              0              0                0  ...          0           0             0               0            0
Actinomyces odontolyticus   Actinomyces                 0              0              0              0                0  ...          0           0             0               0            0
Aeromonas species           Aeromonas                   0              0              0              0                0  ...        100           0             0               0            0
...                                                   ...            ...            ...            ...              ...  ...        ...         ...           ...             ...          ...
Streptococcus milleri group Streptococcus               0              0              0              0                0  ...          0           0             0               0            0
Streptococcus pneumoniae    Streptococcus               0              0              0              0                0  ...          0           0            50               0            0
Streptococcus sanguinis     Streptococcus               0              0              0              0                0  ...          0           0             0               0            0
Streptococcus species       Streptococcus               0              0              0              0                0  ...          0           0             0               0            0
Viridans streptococci       Viridans                    0              0              0              0                0  ...          0           0             0               0            0

[71 rows x 16 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (BLOOD CULTURE)
antimicrobial_name                                                         Amikacin    Ceftazidime    Ceftriaxone     Cefuroxime  ...   Oxacillin  Tetracycline      Tobramycin   Vancomycin
category                                                            Aminoglycosides Cephalosporins Cephalosporins Cephalosporins  ... Penicillins Tetracyclines Aminoglycosides Glycopeptide
microorganism_name                       genus                                                                                    ...
Abiotrophia/granulicatella species       Abiotrophia/granulicatella               0              0             14              0  ...           0             0               0            0
Achromobacter (alcaligenes) dentrificans Achromobacter                           50              0            100              0  ...           0             0             100            0
Achromobacter (alcaligenes) xylosoxid... Achromobacter                           50             50             50              0  ...           0             0             100            0
Achromobacter sp.                        Achromobacter                          100             33            100              0  ...           0             0             100            0
Achromobacter species                    Achromobacter                          100             50            100              0  ...           0             0             100            0
...                                                                             ...            ...            ...            ...  ...         ...           ...             ...          ...
Streptococcus species                    Streptococcus                            0              0              0              0  ...           0             0               0            0
Streptococcus vestibularis               Streptococcus                            0              0              0              0  ...           0             0               0            0
Veillonella species                      Veillonella                              0              0              0              0  ...           0             0               0            0
Viridans streptococci                    Viridans                                 0              0             12              0  ...           0            42               0            0
Wautersiella falsenii                    Wautersiella                           100              0              0              0  ...           0             0             100            0

[198 rows x 16 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (SWAB)
antimicrobial_name                                            Amikacin    Ceftazidime    Ceftriaxone     Cefuroxime  ...   Oxacillin  Tetracycline      Tobramycin   Vancomycin
category                                               Aminoglycosides Cephalosporins Cephalosporins Cephalosporins  ... Penicillins Tetracyclines Aminoglycosides Glycopeptide
microorganism_name                       genus                                                                       ...
Achromobacter (alcaligenes) dentrificans Achromobacter              50             50            100              0  ...           0             0             100            0
Achromobacter (alcaligenes) xylosoxid... Achromobacter             100            100            100              0  ...           0             0             100            0
Achromobacter sp.                        Achromobacter             100             22            100              0  ...           0             0              88            0
Achromobacter species                    Achromobacter             100              0            100              0  ...           0             0             100            0
Acinetobacter baumannii                  Acinetobacter               0             75              0              0  ...           0             0              50            0
...                                                                ...            ...            ...            ...  ...         ...           ...             ...          ...
Streptococcus milleri group              Streptococcus               0              0              0              0  ...           0             0               0            0
Streptococcus mitis                      Streptococcus               0              0              0              0  ...           0             0               0            0
Streptococcus pneumoniae                 Streptococcus               0              0             20              0  ...           0            20               0            0
Streptococcus species                    Streptococcus               0              0              0              0  ...           0             0               0            0
Viridans streptococci                    Viridans                    0              0              0              0  ...           0             0               0            0

[103 rows x 16 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (Staph aureus Screen)
antimicrobial_name                                   Ciprofloxacin Clindamycin Erythromycin      Gentamicin     Levofloxacin   Oxacillin  Tetracycline   Vancomycin
category                                          Fluoroquinolones  Macrolides   Macrolides Aminoglycosides Fluoroquinolones Penicillins Tetracyclines Glycopeptide
microorganism_name                       genus
Positive for methicillin resistant st... Positive                0          61           85               1               74         100             8            0
Staph aureus coag +                      Staph                 100          23           34               0                9           8             3            0
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (URINE)
antimicrobial_name                                               Amikacin    Ceftazidime    Ceftriaxone     Cefuroxime  ...   Oxacillin  Tetracycline      Tobramycin   Vancomycin
category                                                  Aminoglycosides Cephalosporins Cephalosporins Cephalosporins  ... Penicillins Tetracyclines Aminoglycosides Glycopeptide
microorganism_name                       genus                                                                          ...
Achromobacter (alcaligenes) dentrificans Achromobacter                 50              0            100              0  ...           0             0             100            0
Achromobacter (alcaligenes) xylosoxidans Achromobacter                100             50            100              0  ...           0             0              50            0
Achromobacter sp.                        Achromobacter                 80             12            100              0  ...           0             0              62            0
Achromobacter species                    Achromobacter                100             66             66              0  ...           0             0             100            0
Achromobacter xylosoxidans               Achromobacter                  0              0            100              0  ...           0             0             100            0
...                                                                   ...            ...            ...            ...  ...         ...           ...             ...          ...
Stenotrophomonas maltophilia             Stenotrophomonas               0             68              0              0  ...           0             0               0            0
Streptococcus anginosus                  Streptococcus                  0              0              0              0  ...           0             0               0            0
Streptococcus anginosus (milleri) group  Streptococcus                  0              0              0              0  ...           0             0               0            0
Streptococcus bovis group                Streptococcus                  0              0              0              0  ...           0             0               0            0
Viridans streptococci                    Viridans                       0              0              0              0  ...           0             0               0            0

[110 rows x 16 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># Libraries</span>
 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">glob</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
 <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
 <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

 <span class="c1"># Import own libraries</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.freq</span> <span class="kn">import</span> <span class="n">Frequency</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.sari</span> <span class="kn">import</span> <span class="n">SARI</span>
 <span class="kn">from</span> <span class="nn">pyamr.datasets.load</span> <span class="kn">import</span> <span class="n">load_data_mimic</span>

 <span class="c1"># -------------------------</span>
 <span class="c1"># Configuration</span>
 <span class="c1"># -------------------------</span>
 <span class="c1"># Configure seaborn style (context=talk)</span>
 <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

 <span class="c1"># Set matplotlib</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>

 <span class="c1"># Pandas configuration</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

 <span class="c1"># Numpy configuration</span>
 <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


 <span class="c1"># --------------------------------------------------------------------</span>
 <span class="c1">#                               Main</span>
 <span class="c1"># --------------------------------------------------------------------</span>
 <span class="c1"># Load data</span>
 <span class="n">data</span><span class="p">,</span> <span class="n">antibiotics</span><span class="p">,</span> <span class="n">organisms</span> <span class="o">=</span> <span class="n">load_data_mimic</span><span class="p">()</span>

 <span class="c1"># Count records per specimen code</span>
 <span class="n">specimen_code_count</span> <span class="o">=</span> <span class="n">data</span> \
     <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;laboratory_number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

 <span class="c1"># Filter most frequent specimens</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span> \
     <span class="n">specimen_code_count</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])]</span>

 <span class="c1"># Create sari instance</span>
 <span class="n">sari</span> <span class="o">=</span> <span class="n">SARI</span><span class="p">(</span><span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;microorganism_name&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;antimicrobial_name&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sensitivity&#39;</span><span class="p">])</span>

 <span class="c1"># Compute SARI overall</span>
 <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">sari</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
     <span class="n">return_frequencies</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SARI (overall):&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">sari_overall</span><span class="p">)</span>


 <span class="c1"># ------------------------------</span>
 <span class="c1"># Include registries information</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Libraries</span>
 <span class="kn">from</span> <span class="nn">pyamr.datasets.registries</span> <span class="kn">import</span> <span class="n">MicroorganismRegistry</span>
 <span class="kn">from</span> <span class="nn">pyamr.datasets.registries</span> <span class="kn">import</span> <span class="n">AntimicrobialRegistry</span>

 <span class="c1"># Load registry</span>
 <span class="n">mreg</span> <span class="o">=</span> <span class="n">MicroorganismRegistry</span><span class="p">()</span>
 <span class="n">areg</span> <span class="o">=</span> <span class="n">AntimicrobialRegistry</span><span class="p">()</span>

 <span class="c1"># Format sari dataframe</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

 <span class="c1"># Create genus and species</span>
 <span class="n">dataframe</span><span class="p">[[</span><span class="s1">&#39;genus&#39;</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">]]</span> <span class="o">=</span> \
     <span class="n">dataframe</span><span class="o">.</span><span class="n">microorganism_name</span> \
         <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> \
         <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

 <span class="c1"># Combine with registry information</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">mreg</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">areg</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>


 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Plot</span>
 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Libraries</span>
 <span class="kn">from</span> <span class="nn">pyamr.utils.plot</span> <span class="kn">import</span> <span class="n">get_category_colors</span>

 <span class="c1"># Reset</span>
 <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

 <span class="c1"># Loop</span>
 <span class="k">for</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">):</span>

     <span class="c1"># -------------------------------</span>
     <span class="c1"># Create matrix</span>
     <span class="c1"># -------------------------------</span>
     <span class="c1"># Filter</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

     <span class="c1"># Pivot table</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span>
          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;microorganism_name&#39;</span><span class="p">,</span> <span class="s1">&#39;genus&#39;</span><span class="p">],</span>
          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;antimicrobial_name&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">],</span>
          <span class="n">values</span><span class="o">=</span><span class="s1">&#39;sari&#39;</span><span class="p">)</span>

     <span class="c1"># Convert to percent</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span> <span class="o">*</span> <span class="mi">100</span>

     <span class="c1"># Create mask</span>
     <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

     <span class="c1"># Fill missing (error when computing distance)</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span>

     <span class="c1"># Show</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">Data (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

     <span class="c1"># -------------------------------</span>
     <span class="c1"># Plot</span>
     <span class="c1"># -------------------------------</span>
     <span class="c1"># Create colormap</span>
     <span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

     <span class="c1"># Row and col colors</span>
     <span class="n">col_colors</span> <span class="o">=</span> <span class="n">get_category_colors</span><span class="p">(</span> \
         <span class="n">index</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     <span class="n">row_colors</span> <span class="o">=</span> <span class="n">get_category_colors</span><span class="p">(</span> \
         <span class="n">index</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

     <span class="c1"># .. note: It is possible to also pass kwargs that would</span>
     <span class="c1">#          be used by sns.heatmap function (annot, fmt,</span>
     <span class="c1">#          annot_kws, ...</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="c1"># Plot cluster map</span>
         <span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;centroid&#39;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
             <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">row_colors</span><span class="o">=</span><span class="n">row_colors</span><span class="p">,</span> <span class="n">col_colors</span><span class="o">=</span><span class="n">col_colors</span><span class="p">)</span>
     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

     <span class="c1"># Configuration</span>
     <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Antibiogram (clustered) - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
     <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

 <span class="c1"># Show</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  7.239 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-reports-mimic-plot-sari-clustermap-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/ba1fcd82bb062a8a9886c630c5ac597e/plot_sari_clustermap.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_sari_clustermap.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/3503a735b501abb818a9ce0b9fb5bafe/plot_sari_clustermap.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_sari_clustermap.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plot_sari_heatmap.html" class="btn btn-neutral float-right" title="SARI - Antibiogram" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_mimic_treemap.html" class="btn btn-neutral float-left" title="HTML - Treemap (sari)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Bernard Hernandez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>