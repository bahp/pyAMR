

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SART - Spectrum (multiple) &mdash; pyamr 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Describe" href="../nhs/plot_describe.html" />
    <link rel="prev" title="SART - Spectrum (gram type)" href="plot_spectrum_gramtype.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> pyamr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/registries.html">Registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/todo.html">Future Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Galleries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/index.html">Examples with indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../forecasting/index.html">Examples with TSA</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Reports</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#mimic-critical-care">MIMIC Critical Care</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_describe.html">Describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_mimic_treemap.html">HTML - Treemap (sari)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_clustermap.html">SARI - Antibiogram (clustered)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_heatmap.html">SARI - Antibiogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_relmap.html">SARI - Antibiogram (relmap)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_spectrum_gramtype.html">SART - Spectrum (gram type)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SART - Spectrum (multiple)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#imperial-college-nhs-trust">Imperial College NHS Trust</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization/index.html">Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_apidoc/modules.html">pyamr</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyamr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Reports</a> &raquo;</li>
        
      <li>SART - Spectrum (multiple)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/_examples/reports/mimic/plot_spectrum_multiple.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-reports-mimic-plot-spectrum-multiple-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="sart-spectrum-multiple">
<span id="sphx-glr-examples-reports-mimic-plot-spectrum-multiple-py"></span><h1>SART - Spectrum (multiple)<a class="headerlink" href="#sart-spectrum-multiple" title="Permalink to this headline">Â¶</a></h1>
<ul class="sphx-glr-horizontal">
<li><img alt="Gram-positive, Gram-negative, Gram-unknown" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_spectrum_multiple_0011.png" />
</li>
<li><img alt="Gram-positive, Gram-negative, Gram-unknown" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_spectrum_multiple_0021.png" />
</li>
<li><img alt="Gram-positive, Gram-negative, Gram-unknown" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_spectrum_multiple_0031.png" />
</li>
<li><img alt="Gram-positive, Gram-negative, Gram-unknown" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_spectrum_multiple_0041.png" />
</li>
<li><img alt="Gram-positive, Gram-negative, Gram-unknown" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_spectrum_multiple_0051.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SARI (overall):
sensitivity                                               P  intermediate  resistant  sensitive  freq    sari
specimen_code microorganism_name    antimicrobial_name
ABSCESS       Achromobacter species Cefepime            0.0           0.0        1.0        0.0   1.0  1.0000
                                    Ceftazidime         0.0           1.0        0.0        0.0   1.0  1.0000
                                    Ceftriaxone         0.0           0.0        1.0        0.0   1.0  1.0000
                                    Ciprofloxacin       0.0           0.0        0.0        1.0   1.0  0.0000
                                    Gentamicin          0.0           1.0        0.0        0.0   1.0  1.0000
...                                                     ...           ...        ...        ...   ...     ...
URINE         Viridans streptococci Clindamycin         0.0           2.0        0.0        8.0  10.0  0.2000
                                    Erythromycin        0.0           0.0        4.0        6.0  10.0  0.4000
                                    Levofloxacin        0.0           0.0        0.0        1.0   1.0  0.0000
                                    Penicillin g        0.0           2.0        0.0        9.0  11.0  0.1818
                                    Vancomycin          0.0           0.0        0.0       11.0  11.0  0.0000

[5030 rows x 6 columns]
0       0.0
1       0.0
2       0.0
3       0.0
4       0.0
       ...
5025    0.0
5026    0.0
5027    0.0
5028    0.0
5029    0.0
Name: P, Length: 5030, dtype: float64
specimen_code          object
microorganism_name     object
antimicrobial_name     object
P                     float64
intermediate          float64
resistant             float64
sensitive             float64
freq                  float64
sari                  float64
genus                  object
species                object
domain                 object
phylum                 object
class                  object
order                  object
family                 object
acronym                object
gram_stain             object
exists_in_registry       bool
dtype: object
c:\users\kelda\desktop\repositories\github\pyamr\main\pyamr\core\asai.py:468: UserWarning:


                 Extreme resistances were found in the DataFrame. These rows
                 should be reviewed since these resistances might correspond
                 to pairs with low number of records.


c:\users\kelda\desktop\repositories\github\pyamr\main\pyamr\core\asai.py:479: UserWarning:


                 There are NULL values in columns that are required. These
                 rows will be ignored to safely compute ASAI. Please review
                 the DataFrame and address this inconsistencies. See below
                 for more information:

                        specimen_code          0
                        antimicrobial_name     0
                        gram_stain             0
                        GENUS                  0
                        SPECIE                52
                        RESISTANCE             0



ASAI (overall):
                                   N_GENUS           N_SPECIE            ASAI_SCORE                   width   gmean
gram_stain                               n    p    u        n     p    u          n       p       u
specimen_code antimicrobial_name
ABSCESS       Amikacin                 7.0  NaN  2.0      9.0   NaN  2.0     0.9286     NaN  0.0000  0.9286  0.0000
              Ampicillin               4.0  3.0  2.0      6.0   8.0  2.0     0.3750  0.6944  0.5000  1.5694  0.3608
              Ampicillin/sulbactam     5.0  NaN  1.0      7.0   NaN  1.0     0.8000     NaN  1.0000  1.8000  0.8944
              Cefazolin                4.0  NaN  2.0      6.0   NaN  2.0     0.6250     NaN  0.5000  1.1250  0.5590
              Cefepime                17.0  NaN  4.0     22.0   NaN  4.0     0.9000     NaN  0.7500  1.6500  0.8216
...                                    ...  ...  ...      ...   ...  ...        ...     ...     ...     ...     ...
URINE         Rifampin                 1.0  2.0  1.0      1.0   2.0  1.0     1.0000  0.5000  1.0000  2.5000  0.7071
              Tetracycline             8.0  4.0  6.0     11.0  15.0  7.0     0.4375  0.8333  0.6667  1.9375  0.4930
              Tobramycin              20.0  1.0  4.0     50.0   1.0  5.0     0.7933  0.0000  0.7500  1.5433  0.0000
              Trimethoprim/sulfa      24.0  4.0  7.0     58.0   6.0  9.0     0.9583  0.6250  0.9286  2.5119  0.7458
              Vancomycin               NaN  5.0  6.0      NaN  20.0  7.0        NaN  0.9000  1.0000  1.9000  0.9487

[133 rows x 11 columns]


ASAI (ABSCESS)
           specimen_code    antimicrobial_name N_GENUS           N_SPECIE             ASAI_SCORE                   width   gmean
gram_stain                                           n    p    u        n     p     u          n       p       u
14               ABSCESS          Levofloxacin    13.0  3.0  8.0     12.0  10.0   7.0     1.0000  1.0000  1.0000  3.0000  1.0000
16               ABSCESS             Meropenem    18.0  1.0  4.0     23.0   1.0   4.0     0.8778  1.0000  1.0000  2.8778  0.9369
12               ABSCESS            Gentamicin    16.0  3.0  6.0     21.0   6.0   6.0     0.9062  1.0000  0.8333  2.7396  0.8690
24               ABSCESS    Trimethoprim/sulfa    22.0  2.0  8.0     28.0   2.0   7.0     0.9886  1.0000  0.7500  2.7386  0.8611
20               ABSCESS     Piperacillin/tazo    17.0  2.0  6.0     21.0   2.0   6.0     0.9412  1.0000  0.6667  2.6078  0.7921
6                ABSCESS           Ceftriaxone    16.0  2.0  7.0     23.0   8.0   9.0     0.8781  0.5000  0.8571  2.2353  0.6135
18               ABSCESS          Penicillin g     1.0  6.0  8.0      1.0  17.0  10.0     1.0000  0.6042  0.6250  2.2292  0.6145
9                ABSCESS           Clindamycin     1.0  4.0  8.0      1.0  14.0  10.0     1.0000  0.6161  0.5833  2.1994  0.5995
22               ABSCESS          Tetracycline     3.0  3.0  2.0      4.0   8.0   2.0     0.3333  0.8333  1.0000  2.1667  0.5270
7                ABSCESS            Cefuroxime     3.0  1.0  NaN      4.0   1.0   NaN     1.0000  1.0000     NaN  2.0000  1.0000
10               ABSCESS            Daptomycin     NaN  1.0  3.0      NaN   2.0   3.0        NaN  1.0000  1.0000  2.0000  1.0000
15               ABSCESS             Linezolid     NaN  2.0  2.0      NaN   5.0   2.0        NaN  1.0000  1.0000  2.0000  1.0000
13               ABSCESS              Imipenem     9.0  NaN  3.0      8.0   NaN   3.0     0.8889     NaN  1.0000  1.8889  0.9428
25               ABSCESS            Vancomycin     NaN  4.0  7.0      NaN  18.0   9.0        NaN  0.8750  1.0000  1.8750  0.9354
2                ABSCESS  Ampicillin/sulbactam     5.0  NaN  1.0      7.0   NaN   1.0     0.8000     NaN  1.0000  1.8000  0.8944
8                ABSCESS         Ciprofloxacin    18.0  2.0  5.0     23.0   3.0   5.0     0.8778  0.2500  0.6000  1.7278  0.3629
23               ABSCESS            Tobramycin    14.0  NaN  4.0     20.0   NaN   4.0     0.9464     NaN  0.7500  1.6964  0.8425
4                ABSCESS              Cefepime    17.0  NaN  4.0     22.0   NaN   4.0     0.9000     NaN  0.7500  1.6500  0.8216
1                ABSCESS            Ampicillin     4.0  3.0  2.0      6.0   8.0   2.0     0.3750  0.6944  0.5000  1.5694  0.3608
5                ABSCESS           Ceftazidime    18.0  NaN  4.0     23.0   NaN   4.0     0.7944     NaN  0.7500  1.5444  0.7719
21               ABSCESS              Rifampin     NaN  2.0  2.0      NaN   4.0   2.0        NaN  0.3333  1.0000  1.3333  0.5774
19               ABSCESS          Piperacillin     8.0  NaN  2.0     10.0   NaN   2.0     0.7812     NaN  0.5000  1.2812  0.6250
17               ABSCESS             Oxacillin     NaN  1.0  2.0      NaN   4.0   2.0        NaN  0.7500  0.5000  1.2500  0.6124
3                ABSCESS             Cefazolin     4.0  NaN  2.0      6.0   NaN   2.0     0.6250     NaN  0.5000  1.1250  0.5590
11               ABSCESS          Erythromycin     NaN  3.0  6.0      NaN  13.0   8.0        NaN  0.7500  0.2778  1.0278  0.4564
0                ABSCESS              Amikacin     7.0  NaN  2.0      9.0   NaN   2.0     0.9286     NaN  0.0000  0.9286  0.0000


ASAI (BLOOD CULTURE)
            specimen_code    antimicrobial_name N_GENUS             N_SPECIE             ASAI_SCORE                   width   gmean
gram_stain                                            n     p     u        n     p     u          n       p       u
39          BLOOD CULTURE              Imipenem    14.0   2.0   7.0     28.0   2.0   7.0     0.9762  1.0000  0.8571  2.8333  0.9147
48          BLOOD CULTURE              Rifampin     1.0   3.0   4.0      1.0  14.0   4.0     1.0000  0.8333  1.0000  2.8333  0.9129
35          BLOOD CULTURE           Clindamycin     5.0  10.0  12.0      6.0  53.0  17.0     1.0000  0.7795  1.0000  2.7795  0.8829
40          BLOOD CULTURE          Levofloxacin    24.0   5.0  17.0     49.0  30.0  19.0     0.9940  0.8765  0.8039  2.6744  0.8369
51          BLOOD CULTURE    Trimethoprim/sulfa    30.0   7.0  13.0     68.0  14.0  13.0     0.9294  0.8163  0.8462  2.5918  0.8012
38          BLOOD CULTURE            Gentamicin    24.0   4.0  13.0     56.0  22.0  14.0     0.7917  1.0000  0.7692  2.5609  0.7804
47          BLOOD CULTURE     Piperacillin/tazo    25.0   1.0  11.0     55.0   4.0  12.0     0.8700  1.0000  0.6364  2.5064  0.7441
43          BLOOD CULTURE        Nitrofurantoin     2.0   1.0   1.0      2.0   1.0   1.0     0.5000  1.0000  1.0000  2.5000  0.7071
32          BLOOD CULTURE           Ceftriaxone    28.0   6.0  17.0     60.0  28.0  20.0     0.8231  0.6944  0.8922  2.4097  0.7141
31          BLOOD CULTURE           Ceftazidime    24.0   1.0  10.0     58.0   1.0  11.0     0.7718  1.0000  0.6000  2.3718  0.6805
34          BLOOD CULTURE         Ciprofloxacin    27.0   4.0  15.0     60.0   7.0  15.0     0.8651  0.6875  0.8000  2.3526  0.6898
42          BLOOD CULTURE             Meropenem    25.0   4.0  13.0     59.0   7.0  12.0     0.9867  0.5000  0.8077  2.2944  0.6312
37          BLOOD CULTURE          Erythromycin     1.0   8.0   9.0      1.0  46.0  11.0     1.0000  0.5483  0.5556  2.1038  0.5519
36          BLOOD CULTURE            Daptomycin     NaN   5.0   4.0      NaN  24.0   5.0        NaN  1.0000  1.0000  2.0000  1.0000
41          BLOOD CULTURE             Linezolid     NaN   6.0   4.0      NaN  17.0   5.0        NaN  1.0000  1.0000  2.0000  1.0000
45          BLOOD CULTURE          Penicillin g     4.0  13.0  14.0      4.0  53.0  20.0     0.5000  0.7647  0.6190  1.8837  0.4865
27          BLOOD CULTURE            Ampicillin    12.0   6.0   8.0     18.0  13.0   8.0     0.4583  0.7963  0.6250  1.8796  0.4776
49          BLOOD CULTURE          Tetracycline     9.0   6.0   7.0     12.0  18.0   7.0     0.3889  0.6319  0.8571  1.8780  0.4590
52          BLOOD CULTURE            Vancomycin     NaN   9.0   9.0      NaN  59.0  11.0        NaN  0.8519  1.0000  1.8519  0.9230
30          BLOOD CULTURE              Cefepime    23.0   NaN  13.0     55.0   NaN  13.0     0.8054     NaN  0.8077  1.6131  0.8065
28          BLOOD CULTURE  Ampicillin/sulbactam     9.0   1.0   NaN     19.0   1.0   NaN     0.5926  1.0000     NaN  1.5926  0.7698
29          BLOOD CULTURE             Cefazolin     8.0   NaN   1.0     12.0   NaN   1.0     0.5000     NaN  1.0000  1.5000  0.7071
50          BLOOD CULTURE            Tobramycin    22.0   NaN  10.0     53.0   NaN  11.0     0.7273     NaN  0.6000  1.3273  0.6606
44          BLOOD CULTURE             Oxacillin     NaN   2.0   2.0      NaN  18.0   2.0        NaN  0.8235  0.5000  1.3235  0.6417
26          BLOOD CULTURE              Amikacin    19.0   NaN  10.0     30.0   NaN   9.0     0.7982     NaN  0.5000  1.2982  0.6318
46          BLOOD CULTURE          Piperacillin    15.0   NaN   4.0     26.0   NaN   4.0     0.7778     NaN  0.5000  1.2778  0.6236
33          BLOOD CULTURE            Cefuroxime     6.0   NaN   NaN      9.0   NaN   NaN     1.0000     NaN     NaN  1.0000  1.0000


ASAI (SWAB)
           specimen_code    antimicrobial_name N_GENUS            N_SPECIE             ASAI_SCORE                   width   gmean
gram_stain                                           n    p     u        n     p     u          n       p       u
75                  SWAB              Rifampin     1.0  2.0   3.0      1.0   8.0   3.0     1.0000  1.0000  1.0000  3.0000  1.0000
65                  SWAB            Gentamicin    17.0  3.0  11.0     38.0  11.0  12.0     0.8824  0.8611  1.0000  2.7435  0.8717
67                  SWAB          Levofloxacin    17.0  5.0   9.0     29.0  14.0  10.0     0.8824  0.9429  0.8889  2.7141  0.8599
59                  SWAB           Ceftriaxone    21.0  1.0   8.0     40.0   4.0  11.0     0.8095  1.0000  0.8750  2.6845  0.8416
78                  SWAB    Trimethoprim/sulfa    23.0  4.0  10.0     46.0   8.0  11.0     0.9239  0.6667  0.9000  2.4906  0.7445
76                  SWAB          Tetracycline     7.0  4.0   7.0      8.0  13.0   7.0     0.6429  0.7812  0.8571  2.2812  0.6561
54                  SWAB            Ampicillin     7.0  3.0   1.0     14.0   6.0   1.0     0.5714  0.5833  1.0000  2.1548  0.5774
61                  SWAB         Ciprofloxacin    17.0  3.0   8.0     39.0   4.0   9.0     0.8775  0.3333  0.8750  2.0858  0.5059
63                  SWAB            Daptomycin     NaN  3.0   2.0      NaN   8.0   2.0        NaN  1.0000  1.0000  2.0000  1.0000
68                  SWAB             Linezolid     NaN  4.0   3.0      NaN   8.0   3.0        NaN  1.0000  1.0000  2.0000  1.0000
74                  SWAB     Piperacillin/tazo    17.0  NaN   4.0     38.0   NaN   5.0     1.0000     NaN  1.0000  2.0000  1.0000
69                  SWAB             Meropenem    18.0  1.0   7.0     41.0   1.0   8.0     0.9259  0.0000  1.0000  1.9259  0.0000
73                  SWAB          Piperacillin    11.0  NaN   1.0     18.0   NaN   1.0     0.9091     NaN  1.0000  1.9091  0.9535
79                  SWAB            Vancomycin     NaN  5.0   7.0      NaN  23.0  10.0        NaN  0.8800  1.0000  1.8800  0.9381
53                  SWAB              Amikacin    13.0  NaN   1.0     21.0   NaN   1.0     0.8654     NaN  1.0000  1.8654  0.9303
77                  SWAB            Tobramycin    17.0  1.0   7.0     37.0   1.0   8.0     0.8235  0.0000  1.0000  1.8235  0.0000
66                  SWAB              Imipenem    11.0  NaN   2.0     22.0   NaN   3.0     0.8182     NaN  1.0000  1.8182  0.9045
57                  SWAB              Cefepime    17.0  NaN   6.0     39.0   NaN   7.0     0.8039     NaN  1.0000  1.8039  0.8966
56                  SWAB             Cefazolin     6.0  NaN   1.0     12.0   NaN   1.0     0.7000     NaN  1.0000  1.7000  0.8367
58                  SWAB           Ceftazidime    19.0  NaN   7.0     42.0   NaN   8.0     0.8377     NaN  0.7143  1.5520  0.7735
55                  SWAB  Ampicillin/sulbactam     8.0  NaN   2.0     18.0   NaN   2.0     0.5208     NaN  1.0000  1.5208  0.7217
70                  SWAB        Nitrofurantoin     2.0  NaN   2.0      2.0   NaN   2.0     1.0000     NaN  0.5000  1.5000  0.7071
72                  SWAB          Penicillin g     NaN  5.0   6.0      NaN  15.0   9.0        NaN  0.8000  0.3333  1.1333  0.5164
62                  SWAB           Clindamycin     1.0  5.0   6.0      1.0  16.0  10.0     0.0000  0.4850  0.5833  1.0683  0.0000
71                  SWAB             Oxacillin     NaN  1.0   4.0      NaN   8.0   4.0        NaN  0.5000  0.5000  1.0000  0.5000
60                  SWAB            Cefuroxime     5.0  NaN   NaN      7.0   NaN   NaN     0.9000     NaN     NaN  0.9000  0.9487
64                  SWAB          Erythromycin     NaN  3.0   7.0      NaN  17.0  11.0        NaN  0.3889  0.0714  0.4603  0.1667


ASAI (TISSUE)
           specimen_code    antimicrobial_name N_GENUS           N_SPECIE            ASAI_SCORE                   width   gmean
gram_stain                                           n    p    u        n     p    u          n       p       u
92                TISSUE            Gentamicin    16.0  4.0  3.0     33.0  13.0  3.0     0.9375  0.9750  1.0000  2.9125  0.9561
94                TISSUE          Levofloxacin    11.0  4.0  6.0     16.0  17.0  8.0     0.8636  0.8375  1.0000  2.7011  0.8505
89                TISSUE           Clindamycin     1.0  5.0  5.0      1.0  17.0  8.0     1.0000  0.7000  0.9500  2.6500  0.8155
104               TISSUE    Trimethoprim/sulfa    20.0  3.0  4.0     33.0   6.0  4.0     0.9375  0.5556  1.0000  2.4931  0.7217
88                TISSUE         Ciprofloxacin    16.0  3.0  3.0     33.0   5.0  3.0     0.7750  0.6667  1.0000  2.4417  0.7188
81                TISSUE            Ampicillin     7.0  3.0  2.0      9.0   7.0  2.0     0.4762  0.9333  1.0000  2.4095  0.6667
86                TISSUE           Ceftriaxone    19.0  3.0  5.0     28.0   9.0  8.0     0.8684  0.6667  0.8000  2.3351  0.6806
102               TISSUE          Tetracycline     3.0  5.0  5.0      3.0  17.0  5.0     0.6667  0.8267  0.8000  2.2933  0.6640
96                TISSUE             Meropenem    16.0  3.0  3.0     32.0   4.0  3.0     0.9271  0.6667  0.6667  2.2604  0.6419
95                TISSUE             Linezolid     NaN  4.0  3.0      NaN   8.0  3.0        NaN  1.0000  1.0000  2.0000  1.0000
101               TISSUE              Rifampin     NaN  3.0  2.0      NaN  10.0  2.0        NaN  1.0000  1.0000  2.0000  1.0000
90                TISSUE            Daptomycin     NaN  3.0  4.0      NaN   8.0  4.0        NaN  1.0000  1.0000  2.0000  1.0000
93                TISSUE              Imipenem    11.0  NaN  2.0     14.0   NaN  2.0     0.9697     NaN  1.0000  1.9697  0.9847
85                TISSUE           Ceftazidime    17.0  NaN  1.0     34.0   NaN  1.0     0.9471     NaN  1.0000  1.9471  0.9732
103               TISSUE            Tobramycin    16.0  NaN  1.0     33.0   NaN  1.0     0.9375     NaN  1.0000  1.9375  0.9682
105               TISSUE            Vancomycin     NaN  5.0  5.0      NaN  23.0  8.0        NaN  0.9200  1.0000  1.9200  0.9592
100               TISSUE     Piperacillin/tazo    16.0  NaN  1.0     31.0   NaN  1.0     0.8594     NaN  1.0000  1.8594  0.9270
99                TISSUE          Piperacillin     7.0  NaN  1.0      9.0   NaN  1.0     0.7857     NaN  1.0000  1.7857  0.8864
80                TISSUE              Amikacin    11.0  NaN  1.0     12.0   NaN  1.0     0.7273     NaN  1.0000  1.7273  0.8528
84                TISSUE              Cefepime    16.0  NaN  2.0     33.0   NaN  2.0     0.8344     NaN  0.5000  1.3344  0.6459
98                TISSUE          Penicillin g     NaN  6.0  5.0      NaN  16.0  8.0        NaN  0.8000  0.4000  1.2000  0.5657
87                TISSUE            Cefuroxime     4.0  NaN  NaN      5.0   NaN  NaN     1.0000     NaN     NaN  1.0000  1.0000
97                TISSUE             Oxacillin     NaN  1.0  2.0      NaN  10.0  2.0        NaN  0.3000  0.5000  0.8000  0.3873
91                TISSUE          Erythromycin     NaN  3.0  5.0      NaN  17.0  8.0        NaN  0.3556  0.3500  0.7056  0.3528
82                TISSUE  Ampicillin/sulbactam     6.0  NaN  NaN     14.0   NaN  NaN     0.5778     NaN     NaN  0.5778  0.7601
83                TISSUE             Cefazolin     4.0  NaN  1.0      8.0   NaN  1.0     0.3750     NaN  0.0000  0.3750  0.0000


ASAI (URINE)
           specimen_code    antimicrobial_name N_GENUS           N_SPECIE             ASAI_SCORE                   width   gmean
gram_stain                                           n    p    u        n     p     u          n       p       u
116                URINE            Daptomycin     1.0  2.0  2.0      1.0   5.0   2.0     1.0000  1.0000  1.0000  3.0000  1.0000
119                URINE              Imipenem    15.0  1.0  2.0     28.0   1.0   2.0     0.9200  1.0000  1.0000  2.9200  0.9592
122                URINE             Meropenem    21.0  1.0  4.0     52.0   1.0   5.0     0.9524  1.0000  0.7500  2.7024  0.8452
127                URINE     Piperacillin/tazo    20.0  1.0  3.0     48.0   1.0   3.0     0.9400  1.0000  0.6667  2.6067  0.7916
114                URINE         Ciprofloxacin    22.0  4.0  6.0     52.0   7.0   7.0     0.7909  0.7917  1.0000  2.5826  0.7913
131                URINE    Trimethoprim/sulfa    24.0  4.0  7.0     58.0   6.0   9.0     0.9583  0.6250  0.9286  2.5119  0.7458
128                URINE              Rifampin     1.0  2.0  1.0      1.0   2.0   1.0     1.0000  0.5000  1.0000  2.5000  0.7071
120                URINE          Levofloxacin    21.0  4.0  8.0     38.0  12.0  10.0     0.8857  0.8452  0.7500  2.4810  0.7493
111                URINE           Ceftazidime    22.0  1.0  4.0     53.0   1.0   5.0     0.7114  1.0000  0.7500  2.4614  0.7304
112                URINE           Ceftriaxone    22.0  3.0  6.0     53.0   5.0   7.0     0.7818  0.8333  0.8333  2.4485  0.7368
118                URINE            Gentamicin    20.0  4.0  7.0     50.0  11.0  10.0     0.7933  0.7500  0.8571  2.4005  0.7141
123                URINE        Nitrofurantoin    14.0  2.0  5.0     37.0  13.0   7.0     0.6071  0.9167  0.8000  2.3238  0.6673
115                URINE           Clindamycin     1.0  4.0  6.0      1.0   6.0   7.0     1.0000  0.5000  0.5000  2.0000  0.5000
121                URINE             Linezolid     NaN  2.0  2.0      NaN   6.0   2.0        NaN  1.0000  1.0000  2.0000  1.0000
107                URINE            Ampicillin    12.0  3.0  6.0     22.0   8.0   6.0     0.3750  0.9444  0.6667  1.9861  0.4859
129                URINE          Tetracycline     8.0  4.0  6.0     11.0  15.0   7.0     0.4375  0.8333  0.6667  1.9375  0.4930
132                URINE            Vancomycin     NaN  5.0  6.0      NaN  20.0   7.0        NaN  0.9000  1.0000  1.9000  0.9487
110                URINE              Cefepime    20.0  2.0  5.0     50.0   2.0   6.0     0.7800  0.0000  0.8000  1.5800  0.0000
126                URINE          Piperacillin    14.0  NaN  2.0     25.0   NaN   3.0     0.8095     NaN  0.7500  1.5595  0.7792
130                URINE            Tobramycin    20.0  1.0  4.0     50.0   1.0   5.0     0.7933  0.0000  0.7500  1.5433  0.0000
125                URINE          Penicillin g     NaN  5.0  5.0      NaN  12.0   6.0        NaN  0.9333  0.6000  1.5333  0.7483
109                URINE             Cefazolin    12.0  NaN  2.0     23.0   NaN   2.0     0.3972     NaN  1.0000  1.3972  0.6303
108                URINE  Ampicillin/sulbactam    13.0  1.0  3.0     26.0   1.0   3.0     0.6000  0.0000  0.6667  1.2667  0.0000
124                URINE             Oxacillin     NaN  1.0  4.0      NaN   7.0   5.0        NaN  0.4286  0.7500  1.1786  0.5669
117                URINE          Erythromycin     NaN  4.0  6.0      NaN   7.0   7.0        NaN  0.4167  0.5000  0.9167  0.4564
113                URINE            Cefuroxime     5.0  NaN  1.0      8.0   NaN   1.0     0.8000     NaN  0.0000  0.8000  0.0000
106                URINE              Amikacin    16.0  1.0  2.0     29.0   1.0   2.0     0.6719  0.0000  0.0000  0.6719  0.0000
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">glob</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
 <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
 <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

 <span class="c1"># Import specific libraries</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.sari</span> <span class="kn">import</span> <span class="n">SARI</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.asai</span> <span class="kn">import</span> <span class="n">ASAI</span>
 <span class="kn">from</span> <span class="nn">pyamr.datasets.load</span> <span class="kn">import</span> <span class="n">load_data_mimic</span>
 <span class="kn">from</span> <span class="nn">pyamr.datasets.registries</span> <span class="kn">import</span> <span class="n">MicroorganismRegistry</span>
 <span class="kn">from</span> <span class="nn">pyamr.utils.plot</span> <span class="kn">import</span> <span class="n">scalar_colormap</span>

 <span class="c1"># Configure seaborn style (context=talk)</span>
 <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

 <span class="c1"># Set matplotlib</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>

 <span class="c1"># Pandas configuration</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

 <span class="c1"># Numpy configuration</span>
 <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

 <span class="c1"># --------------------------------------------------------------------</span>
 <span class="c1">#                               Main</span>
 <span class="c1"># --------------------------------------------------------------------</span>
 <span class="c1"># Load data</span>
 <span class="n">data</span><span class="p">,</span> <span class="n">antibiotics</span><span class="p">,</span> <span class="n">organisms</span> <span class="o">=</span> <span class="n">load_data_mimic</span><span class="p">()</span>

 <span class="c1"># Count records per specimen code</span>
 <span class="n">specimen_code_count</span> <span class="o">=</span> <span class="n">data</span> \
     <span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
     <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

 <span class="c1"># Filter most frequent specimens</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span> \
     <span class="n">specimen_code_count</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])]</span>

 <span class="c1"># -------------------</span>
 <span class="c1"># Compute SARI</span>
 <span class="c1"># -------------------</span>
 <span class="c1"># Create sari instance</span>
 <span class="n">sari</span> <span class="o">=</span> <span class="n">SARI</span><span class="p">(</span><span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;microorganism_name&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;antimicrobial_name&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sensitivity&#39;</span><span class="p">])</span>

 <span class="c1"># Compute SARI overall</span>
 <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">sari</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
     <span class="n">return_frequencies</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SARI (overall):&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">sari_overall</span><span class="p">)</span>

 <span class="c1"># ------------------------------</span>
 <span class="c1"># Include registry information</span>
 <span class="c1"># ------------------------------</span>
 <span class="c1"># Load registry</span>
 <span class="n">mreg</span> <span class="o">=</span> <span class="n">MicroorganismRegistry</span><span class="p">()</span>

 <span class="c1"># Format sari dataframe</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

 <span class="c1"># Create genus and species</span>
 <span class="n">dataframe</span><span class="p">[[</span><span class="s1">&#39;genus&#39;</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">]]</span> <span class="o">=</span> \
     <span class="n">dataframe</span><span class="o">.</span><span class="n">microorganism_name</span> \
         <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> \
         <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

 <span class="c1"># Combine with registry information</span>
 <span class="n">dataframe</span> <span class="o">=</span> <span class="n">mreg</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>

 <span class="c1"># Fill missing gram stain</span>
 <span class="n">dataframe</span><span class="o">.</span><span class="n">gram_stain</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">gram_stain</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>

 <span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

 <span class="c1"># -------------------------------</span>
 <span class="c1"># Compute ASAI</span>
 <span class="c1"># -------------------------------</span>
 <span class="c1"># Create asai instance</span>
 <span class="n">asai</span> <span class="o">=</span> <span class="n">ASAI</span><span class="p">(</span><span class="n">column_genus</span><span class="o">=</span><span class="s1">&#39;genus&#39;</span><span class="p">,</span>
             <span class="n">column_specie</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span>
             <span class="n">column_resistance</span><span class="o">=</span><span class="s1">&#39;sari&#39;</span><span class="p">,</span>
             <span class="n">column_frequency</span><span class="o">=</span><span class="s1">&#39;freq&#39;</span><span class="p">)</span>

 <span class="c1"># Compute</span>
 <span class="n">scores</span> <span class="o">=</span> <span class="n">asai</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span>
     <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">,</span>
              <span class="s1">&#39;antimicrobial_name&#39;</span><span class="p">,</span>
              <span class="s1">&#39;gram_stain&#39;</span><span class="p">],</span>
     <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
     <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
     <span class="n">min_freq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

 <span class="c1"># Stack</span>
 <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>

 <span class="c1"># .. note: In order to sort the scores we need to compute metrics</span>
 <span class="c1">#          that combine the different subcategories (e.g. gram-negative</span>
 <span class="c1">#          and gram-positive). Two possible options are: (i) use the</span>
 <span class="c1">#          gmean or (ii) the width.</span>
 <span class="c1"># Measures</span>
 <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;ASAI_SCORE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
 <span class="n">scores</span><span class="p">[</span><span class="s1">&#39;gmean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s1">&#39;ASAI_SCORE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ASAI (overall):&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>


 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Plot</span>
 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Reset</span>
 <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

 <span class="c1"># Loop</span>
 <span class="k">for</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">scores</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">):</span>
     <span class="c1"># Sort</span>
     <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

     <span class="c1"># Show</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">ASAI (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

     <span class="c1"># Variables to plot.</span>
     <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">antimicrobial_name</span>
     <span class="n">y_n</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ASAI_SCORE&#39;</span><span class="p">][</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
     <span class="n">y_p</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ASAI_SCORE&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
     <span class="n">y_u</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ASAI_SCORE&#39;</span><span class="p">][</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

     <span class="c1"># Constants</span>
     <span class="n">colormap_p</span> <span class="o">=</span> <span class="n">scalar_colormap</span><span class="p">(</span><span class="n">y_p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
     <span class="n">colormap_n</span> <span class="o">=</span> <span class="n">scalar_colormap</span><span class="p">(</span><span class="n">y_n</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
     <span class="n">colormap_u</span> <span class="o">=</span> <span class="n">scalar_colormap</span><span class="p">(</span><span class="n">y_u</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>

     <span class="c1"># ----------</span>
     <span class="c1"># Example</span>
     <span class="c1"># ----------</span>
     <span class="c1"># This example shows an stacked figure using more than two categories.</span>
     <span class="c1"># For instance, it uses gram-positive, gram-negative and gram-unknown.</span>
     <span class="c1"># All theindexes go within the range [0,1].</span>
     <span class="c1"># Create the figure</span>
     <span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

     <span class="c1"># Plot each category</span>
     <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_p</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">colormap_p</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
                 <span class="n">saturation</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gram-positive&#39;</span><span class="p">)</span>
     <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_n</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">colormap_n</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
                 <span class="n">saturation</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gram-negative&#39;</span><span class="p">)</span>
     <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_u</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">colormap_u</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
                 <span class="n">saturation</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gram-unknown&#39;</span><span class="p">)</span>

     <span class="c1"># Configure</span>
     <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

     <span class="c1"># Format figure</span>
     <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

     <span class="c1"># Remove yticks</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

     <span class="c1"># Set title</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gram-positive&#39;</span><span class="p">)</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gram-negative&#39;</span><span class="p">)</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gram-unknown&#39;</span><span class="p">)</span>

     <span class="c1"># Set x-axis</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

     <span class="c1"># Remove ylabels</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
     <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

     <span class="c1"># Adjust</span>
     <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

 <span class="c1"># Show</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  6.749 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-reports-mimic-plot-spectrum-multiple-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/97e590364bb502ee8fe7f506a786e3e6/plot_spectrum_multiple.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_spectrum_multiple.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/2813a73c7a8e3c509235ec9b5d855709/plot_spectrum_multiple.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_spectrum_multiple.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../nhs/plot_describe.html" class="btn btn-neutral float-right" title="Describe" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_spectrum_gramtype.html" class="btn btn-neutral float-left" title="SART - Spectrum (gram type)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Bernard Hernandez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>