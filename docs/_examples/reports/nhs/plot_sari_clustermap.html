<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SARI - Antibiogram (clustered) &mdash; pyamr 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/logo-pyamr-icon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="SARI - Antibiogram" href="plot_sari_heatmap.html" />
    <link rel="prev" title="HTML - Treemap (sari)" href="plot_nhs_treemap.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> pyamr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/registries.html">Registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/todo.html">Future Actions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Galleries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/index.html">Examples with indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../forecasting/index.html">Examples with TSA</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Reports</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#mimic-critical-care">MIMIC Critical Care</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#imperial-college-nhs-trust">Imperial College NHS Trust</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_describe.html">Describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_nhs_treemap.html">HTML - Treemap (sari)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SARI - Antibiogram (clustered)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_heatmap.html">SARI - Antibiogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_sari_relmap.html">SARI - Antibiogram (relmap)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_spectrum_gramtype.html">SART - Spectrum (gram type)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_spectrum_multiple.html">SART - Spectrum (multiple)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization/index.html">Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_apidoc/modules.html">pyamr</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyamr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Reports</a> &raquo;</li>
      <li>SARI - Antibiogram (clustered)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/_examples/reports/nhs/plot_sari_clustermap.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-reports-nhs-plot-sari-clustermap-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="sari-antibiogram-clustered">
<span id="sphx-glr-examples-reports-nhs-plot-sari-clustermap-py"></span><h1>SARI - Antibiogram (clustered)<a class="headerlink" href="#sari-antibiogram-clustered" title="Permalink to this headline">ÔÉÅ</a></h1>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Explain and Simplify</p>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Antibiogram (clustered) - BLDCUL" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0012.png" />
</li>
<li><img alt="Antibiogram (clustered) - GUMCUL" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0022.png" />
</li>
<li><img alt="Antibiogram (clustered) - SPTCUL" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0032.png" />
</li>
<li><img alt="Antibiogram (clustered) - URICUL" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0042.png" />
</li>
<li><img alt="Antibiogram (clustered) - WOUCUL" class="sphx-glr-multi-img" src="../../../_images/sphx_glr_plot_sari_clustermap_0052.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>SARI (overall):
sensitivity                                          fix  hide  highly resistant  intermediate  not done  resistant  sensitive  freq    sari
specimen_code microorganism_name antimicrobial_name
BLDCUL        abiotrophia        clindamycin         0.0   0.0               0.0           0.0       0.0        0.0        1.0   1.0  0.0000
                                 erythromycin        0.0   0.0               0.0           0.0       0.0        1.0        0.0   1.0  1.0000
                                 penicillin          0.0   0.0               0.0           0.0       0.0        0.0        1.0   1.0  0.0000
                                 teicoplanin         0.0   0.0               0.0           0.0       0.0        1.0        0.0   1.0  1.0000
                                 vancomycin          0.0   0.0               0.0           0.0       0.0        0.0        1.0   1.0  0.0000
...                                                  ...   ...               ...           ...       ...        ...        ...   ...     ...
WOUCUL        yeasts             tetracycline        0.0   0.0               0.0           0.0       0.0        6.0       15.0  21.0  0.2857
                                 tigecycline         0.0   0.0               0.0           2.0       0.0        0.0        8.0  10.0  0.2000
                                 tobramycin          0.0   0.0               0.0           0.0       0.0        4.0        6.0  10.0  0.4000
                                 trimethoprim        0.0   0.0               0.0           0.0       0.0        1.0       20.0  21.0  0.0476
                                 vancomycin          0.0   0.0               0.0           0.0       0.0        0.0        6.0   6.0  0.0000

[10991 rows x 9 columns]



Data (BLDCUL)
antimicrobial_name                               Amikacin      Amoxycillin Azithromycin   Aztreonam       Cefixime  ...  Temocillin  Tetracycline   Tigecycline      Tobramycin   Vancomycin
category                                  Aminoglycosides Aminopenicillins   Macrolides Monobactams Cephalosporins  ... Penicillins Tetracyclines Tetracyclines Aminoglycosides Glycopeptide
microorganism_name          genus                                                                                   ...
abiotrophia                 Abiotrophia                 0                0            0           0              0  ...           0             0             0               0            0
achromobacter               Achromobacter              72               66            0         100              0  ...         100             0            11              80            0
achromobacter xylosoxidans  Achromobacter             100               88            0         100              0  ...         100             0            50             100            0
acinetobacter               Acinetobacter               8               27            0          76              0  ...          68             0             8              10            0
acinetobacter baumannii     Acinetobacter              39               93            0         100              0  ...         100             0            42              48            0
...                                                   ...              ...          ...         ...            ...  ...         ...           ...           ...             ...          ...
streptococcus sanguis       Streptococcus               0                0            0           0              0  ...           0             4             0               0            0
streptococcus vestibularis  Streptococcus               0                0            0           0              0  ...           0             0             0               0            0
streptococcus viridans      Streptococcus               0                0            0           0              0  ...           0            22             0               0            2
veillonella                 Veillonella                 0                0            0           0              0  ...           0             0             0               0            0
yersinia pseudotuberculosis Yersinia                    0                0            0           0              0  ...           0             0             0               0            0

[204 rows x 38 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (GUMCUL)
antimicrobial_name                                            Amikacin      Amoxycillin Azithromycin   Aztreonam       Cefixime  ...  Penicillin  Teicoplanin  Temocillin  Tetracycline   Vancomycin
category                                               Aminoglycosides Aminopenicillins   Macrolides Monobactams Cephalosporins  ... Penicillins Glycopeptide Penicillins Tetracyclines Glycopeptide
microorganism_name                      genus                                                                                    ...
anaerobes mixed                         Anaerobes                    0                0            0           0              0  ...           0            0           0             0            0
campylobacter                           Campylobacter                0                0            0           0              0  ...           0            0           0             0            0
escherichia coli                        Escherichia                  0              100            0           0              0  ...           0            0           0             0            0
neisseria gonorrhoeae                   Neisseria                    0                0            0           0              0  ...           0            0           0            76            0
neisseria gonorrhoeae not isolated      Neisseria                    0                0            0           0              0  ...           0            0           0             0            0
neisseria meningitidis                  Neisseria                    0                0            1           0              0  ...          18            0           0            79            0
pseudomonas aeruginosa                  Pseudomonas                  0                0            0           0              0  ...           0            0           0             0            0
staphylococcus aureus                   Staphylococcus               0                0            0           0              0  ...          50            0           0             0            0
streptococcus beta-haemolytic group a   Streptococcus                0                0            0           0              0  ...           0            0           0           100            0
streptococcus beta-haemolytic group b   Streptococcus                0                0            0           0              0  ...           0            0           0            50            0
streptococcus beta-haemolytic group c/g Streptococcus                0                0            0           0              0  ...           0            0           0            50            0
streptococcus milleri                   Streptococcus                0                0            0           0              0  ...           0            0           0           100            0

[12 rows x 24 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (SPTCUL)
antimicrobial_name                              Amikacin      Amoxycillin Azithromycin   Aztreonam     Cefotaxime  ...  Temocillin  Tetracycline   Tigecycline      Tobramycin   Vancomycin
category                                 Aminoglycosides Aminopenicillins   Macrolides Monobactams Cephalosporins  ... Penicillins Tetracyclines Tetracyclines Aminoglycosides Glycopeptide
microorganism_name         genus                                                                                   ...
achromobacter              Achromobacter              92               28            0         100             85  ...         100             0            66              92            0
achromobacter xylosoxidans Achromobacter              95               66            0         100             90  ...         100             0            27              92            0
acinetobacter              Acinetobacter               6               90            0          91             83  ...          97             0            12              36            0
acinetobacter baumannii    Acinetobacter              50               98            0          95             98  ...         100             0            40              57            0
acinetobacter lwoffi       Acinetobacter               0                0            0           0              0  ...           0             0             0               0            0
...                                                  ...              ...          ...         ...            ...  ...         ...           ...           ...             ...          ...
streptococcus salivarius   Streptococcus               0                0            0           0              0  ...           0             0             0               0            0
veillonella                Veillonella                 0                0            0           0              0  ...           0             0             0               0            0
yeast                      Yeast                       0                0            0           0              0  ...           0             0             0               0            0
yeast: germ tube negative  Yeast:                      0                0            0          16              0  ...           0             0             0               0            0
yeasts                     Yeasts                     21              100            0          23              0  ...          20             0             0              23            0

[117 rows x 34 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (URICUL)
antimicrobial_name                              Amikacin      Amoxycillin Azithromycin   Aztreonam       Cefixime  ...  Temocillin  Tetracycline   Tigecycline      Tobramycin   Vancomycin
category                                 Aminoglycosides Aminopenicillins   Macrolides Monobactams Cephalosporins  ... Penicillins Tetracyclines Tetracyclines Aminoglycosides Glycopeptide
microorganism_name         genus                                                                                   ...
achromobacter              Achromobacter             100                0            0           0              0  ...         100             0             0               0            0
achromobacter xylosoxidans Achromobacter             100                0            0         100              0  ...         100             0             0             100            0
acinetobacter              Acinetobacter               4                0            0         100              0  ...          70             0             0               0            0
acinetobacter baumannii    Acinetobacter              18              100            0         100              0  ...          90             0           100              42            0
acinetobacter lwoffi       Acinetobacter               0                0            0           0              0  ...           0             0             0               0            0
...                                                  ...              ...          ...         ...            ...  ...         ...           ...           ...             ...          ...
streptococcus parasanguis  Streptococcus               0                0            0           0              0  ...           0             0             0               0            0
streptococcus pyogenes     Streptococcus               0                0            0           0              0  ...           0             0             0               0            0
streptococcus salivarius   Streptococcus               0                0            0           0              0  ...           0             0             0               0            0
streptococcus viridans     Streptococcus               0                0            0           0              0  ...           0           100             0               0            0
yeasts                     Yeasts                      0                0            0           0              0  ...           0             0             0               0            0

[112 rows x 38 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (WOUCUL)
antimicrobial_name                              Amikacin      Amoxycillin Azithromycin   Aztreonam   Bacitracin  ...  Temocillin  Tetracycline   Tigecycline      Tobramycin   Vancomycin
category                                 Aminoglycosides Aminopenicillins   Macrolides Monobactams Polypeptides  ... Penicillins Tetracyclines Tetracyclines Aminoglycosides Glycopeptide
microorganism_name         genus                                                                                 ...
achromobacter              Achromobacter              66               53            0         100            0  ...         100             0            12              80            0
achromobacter xylosoxidans Achromobacter             100               57            0         100            0  ...          92             0            28             100            0
acinetobacter              Acinetobacter               2               43            0          85            0  ...          60             0            12              10            0
acinetobacter baumannii    Acinetobacter              32               97            0          94            0  ...          96             0            38              36            0
acinetobacter haemolyticus Acinetobacter               0                0            0           0            0  ...          50             0             0               0            0
...                                                  ...              ...          ...         ...          ...  ...         ...           ...           ...             ...          ...
streptococcus sanguis      Streptococcus               0                0            0           0            0  ...           0           100             0               0            0
streptococcus viridans     Streptococcus               0                0            0           0            0  ...           0            30             0               0            0
veillonella                Veillonella                 0                0            0           0            0  ...           0             0             0               0            0
yeast                      Yeast                       0                0            0           0            0  ...           0             0             0               0            0
yeasts                     Yeasts                      0               78            0          70            0  ...          50            28            20              40            0

[192 rows x 39 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 12</span> <span class="c1"># Libraries</span>
<span class="linenos"> 13</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 14</span> <span class="kn">import</span> <span class="nn">glob</span>
<span class="linenos"> 15</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 16</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="linenos"> 17</span> <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="linenos"> 18</span> <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="linenos"> 19</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span> <span class="c1"># Import own libraries</span>
<span class="linenos"> 22</span> <span class="kn">from</span> <span class="nn">pyamr.core.freq</span> <span class="kn">import</span> <span class="n">Frequency</span>
<span class="linenos"> 23</span> <span class="kn">from</span> <span class="nn">pyamr.core.sari</span> <span class="kn">import</span> <span class="n">SARI</span>
<span class="linenos"> 24</span> <span class="kn">from</span> <span class="nn">pyamr.datasets.load</span> <span class="kn">import</span> <span class="n">load_data_nhs</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span> <span class="c1"># -------------------------</span>
<span class="linenos"> 27</span> <span class="c1"># Configuration</span>
<span class="linenos"> 28</span> <span class="c1"># -------------------------</span>
<span class="linenos"> 29</span> <span class="c1"># Configure seaborn style (context=talk)</span>
<span class="linenos"> 30</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span> <span class="c1"># Set matplotlib</span>
<span class="linenos"> 33</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="linenos"> 34</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="linenos"> 35</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
<span class="linenos"> 36</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="linenos"> 37</span>
<span class="linenos"> 38</span> <span class="c1"># Pandas configuration</span>
<span class="linenos"> 39</span> <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="linenos"> 40</span> <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="linenos"> 41</span> <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span> <span class="c1"># Numpy configuration</span>
<span class="linenos"> 44</span> <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span> <span class="c1"># --------------------------------------------------------------------</span>
<span class="linenos"> 48</span> <span class="c1">#                               Main</span>
<span class="linenos"> 49</span> <span class="c1"># --------------------------------------------------------------------</span>
<span class="linenos"> 50</span> <span class="c1"># Load data</span>
<span class="linenos"> 51</span> <span class="n">data</span><span class="p">,</span> <span class="n">antibiotics</span><span class="p">,</span> <span class="n">organisms</span> <span class="o">=</span> <span class="n">load_data_nhs</span><span class="p">()</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span> <span class="c1"># Count records per specimen code</span>
<span class="linenos"> 54</span> <span class="n">specimen_code_count</span> <span class="o">=</span> <span class="n">data</span> \
<span class="linenos"> 55</span>     <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;laboratory_number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> \
<span class="linenos"> 56</span>     <span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
<span class="linenos"> 57</span>     <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span> <span class="c1"># Filter most frequent specimens</span>
<span class="linenos"> 60</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span> \
<span class="linenos"> 61</span>     <span class="n">specimen_code_count</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])]</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span> <span class="c1"># Create sari instance</span>
<span class="linenos"> 64</span> <span class="n">sari</span> <span class="o">=</span> <span class="n">SARI</span><span class="p">(</span><span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">,</span>
<span class="linenos"> 65</span>                      <span class="s1">&#39;microorganism_name&#39;</span><span class="p">,</span>
<span class="linenos"> 66</span>                      <span class="s1">&#39;antimicrobial_name&#39;</span><span class="p">,</span>
<span class="linenos"> 67</span>                      <span class="s1">&#39;sensitivity&#39;</span><span class="p">])</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span> <span class="c1"># Compute SARI overall</span>
<span class="linenos"> 70</span> <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">sari</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
<span class="linenos"> 71</span>     <span class="n">return_frequencies</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span> <span class="c1"># Show</span>
<span class="linenos"> 74</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SARI (overall):&quot;</span><span class="p">)</span>
<span class="linenos"> 75</span> <span class="nb">print</span><span class="p">(</span><span class="n">sari_overall</span><span class="p">)</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span> <span class="c1"># ------------------------------</span>
<span class="linenos"> 79</span> <span class="c1"># Include registries information</span>
<span class="linenos"> 80</span> <span class="c1"># ------------------------------</span>
<span class="linenos"> 81</span> <span class="c1"># Libraries</span>
<span class="linenos"> 82</span> <span class="kn">from</span> <span class="nn">pyamr.datasets.registries</span> <span class="kn">import</span> <span class="n">MicroorganismRegistry</span>
<span class="linenos"> 83</span> <span class="kn">from</span> <span class="nn">pyamr.datasets.registries</span> <span class="kn">import</span> <span class="n">AntimicrobialRegistry</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span> <span class="c1"># Load registry</span>
<span class="linenos"> 86</span> <span class="n">mreg</span> <span class="o">=</span> <span class="n">MicroorganismRegistry</span><span class="p">()</span>
<span class="linenos"> 87</span> <span class="n">areg</span> <span class="o">=</span> <span class="n">AntimicrobialRegistry</span><span class="p">()</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span> <span class="c1"># Format sari dataframe</span>
<span class="linenos"> 90</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 91</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span> <span class="c1"># Create genus and species</span>
<span class="linenos"> 94</span> <span class="n">dataframe</span><span class="p">[[</span><span class="s1">&#39;genus&#39;</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">]]</span> <span class="o">=</span> \
<span class="linenos"> 95</span>     <span class="n">dataframe</span><span class="o">.</span><span class="n">microorganism_name</span> \
<span class="linenos"> 96</span>         <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> \
<span class="linenos"> 97</span>         <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span> <span class="c1"># Combine with registry information</span>
<span class="linenos">100</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">mreg</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
<span class="linenos">101</span> <span class="n">dataframe</span> <span class="o">=</span> <span class="n">areg</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">dataframe</span><span class="p">)</span>
<span class="linenos">102</span>
<span class="linenos">103</span>
<span class="linenos">104</span> <span class="c1"># -------------------------------------------</span>
<span class="linenos">105</span> <span class="c1"># Plot</span>
<span class="linenos">106</span> <span class="c1"># -------------------------------------------</span>
<span class="linenos">107</span> <span class="c1"># Libraries</span>
<span class="linenos">108</span> <span class="kn">from</span> <span class="nn">pyamr.utils.plot</span> <span class="kn">import</span> <span class="n">get_category_colors</span>
<span class="linenos">109</span>
<span class="linenos">110</span> <span class="c1"># Reset</span>
<span class="linenos">111</span> <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="linenos">112</span>
<span class="linenos">113</span> <span class="c1"># Loop</span>
<span class="linenos">114</span> <span class="k">for</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">):</span>
<span class="linenos">115</span>
<span class="linenos">116</span>     <span class="c1"># -------------------------------</span>
<span class="linenos">117</span>     <span class="c1"># Create matrix</span>
<span class="linenos">118</span>     <span class="c1"># -------------------------------</span>
<span class="linenos">119</span>     <span class="c1"># Filter</span>
<span class="linenos">120</span>     <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">121</span>     <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="linenos">122</span>
<span class="linenos">123</span>     <span class="c1"># Pivot table</span>
<span class="linenos">124</span>     <span class="n">matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span>
<span class="linenos">125</span>          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;microorganism_name&#39;</span><span class="p">,</span> <span class="s1">&#39;genus&#39;</span><span class="p">],</span>
<span class="linenos">126</span>          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;antimicrobial_name&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">],</span>
<span class="linenos">127</span>          <span class="n">values</span><span class="o">=</span><span class="s1">&#39;sari&#39;</span><span class="p">)</span>
<span class="linenos">128</span>
<span class="linenos">129</span>     <span class="c1"># Convert to percent</span>
<span class="linenos">130</span>     <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span> <span class="o">*</span> <span class="mi">100</span>
<span class="linenos">131</span>
<span class="linenos">132</span>     <span class="c1"># Create mask</span>
<span class="linenos">133</span>     <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
<span class="linenos">134</span>
<span class="linenos">135</span>     <span class="c1"># Fill missing (error when computing distance)</span>
<span class="linenos">136</span>     <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span>
<span class="linenos">137</span>
<span class="linenos">138</span>     <span class="c1"># Show</span>
<span class="linenos">139</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">Data (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">)</span>
<span class="linenos">140</span>     <span class="nb">print</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="linenos">141</span>
<span class="linenos">142</span>     <span class="c1"># -------------------------------</span>
<span class="linenos">143</span>     <span class="c1"># Plot</span>
<span class="linenos">144</span>     <span class="c1"># -------------------------------</span>
<span class="linenos">145</span>     <span class="c1"># Create colormap</span>
<span class="linenos">146</span>     <span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">147</span>
<span class="linenos">148</span>     <span class="c1"># Row and col colors</span>
<span class="linenos">149</span>     <span class="n">col_colors</span> <span class="o">=</span> <span class="n">get_category_colors</span><span class="p">(</span> \
<span class="linenos">150</span>         <span class="n">index</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">151</span>     <span class="n">row_colors</span> <span class="o">=</span> <span class="n">get_category_colors</span><span class="p">(</span> \
<span class="linenos">152</span>         <span class="n">index</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">153</span>
<span class="linenos">154</span>     <span class="c1"># .. note: It is possible to also pass kwargs that would</span>
<span class="linenos">155</span>     <span class="c1">#          be used by sns.heatmap function (annot, fmt,</span>
<span class="linenos">156</span>     <span class="c1">#          annot_kws, ...</span>
<span class="linenos">157</span>     <span class="k">try</span><span class="p">:</span>
<span class="linenos">158</span>         <span class="c1"># Plot cluster map</span>
<span class="linenos">159</span>         <span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="linenos">160</span>             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;centroid&#39;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
<span class="linenos">161</span>             <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">162</span>             <span class="n">row_colors</span><span class="o">=</span><span class="n">row_colors</span><span class="p">,</span> <span class="n">col_colors</span><span class="o">=</span><span class="n">col_colors</span><span class="p">)</span>
<span class="linenos">163</span>     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">164</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
<span class="linenos">165</span>
<span class="linenos">166</span>     <span class="c1"># Configuration</span>
<span class="linenos">167</span>     <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Antibiogram (clustered) - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="linenos">168</span>     <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="linenos">169</span>
<span class="linenos">170</span> <span class="c1"># Show</span>
<span class="linenos">171</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  13.992 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-reports-nhs-plot-sari-clustermap-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/f1a896ce9caf9a796cc5cba64db952d5/plot_sari_clustermap.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_sari_clustermap.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/b88e7e6bf0a56fcfa62b5963cbf65852/plot_sari_clustermap.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_sari_clustermap.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_nhs_treemap.html" class="btn btn-neutral float-left" title="HTML - Treemap (sari)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plot_sari_heatmap.html" class="btn btn-neutral float-right" title="SARI - Antibiogram" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Bernard Hernandez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>