

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SARI - Clustermap (by specimen) &mdash; pyamr 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SARI - Relplot (by specimen)" href="plot_relmap_02.html" />
    <link rel="prev" title="SARI - Antibiogram (by specimen)" href="plot_antibiogram_02.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyamr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/registries.html">Registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/todo.html">Future Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Galleries</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples with AMR indexes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="plot_antibiogram_02.html">SARI - Antibiogram (by specimen)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SARI - Clustermap (by specimen)</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_relmap_02.html">SARI - Relplot (by specimen)</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_spectrum_gramtype.html">ASAI - gram type</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_spectrum_multiple.html">ASAI - Multiple</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_temporal_asai.html">ASAI - Timeseries</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_temporal_sari.html">SARI - Timeseries</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_wls_basic.html">SART - through WLS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../forecasting/index.html">Examples with TSA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reports/index.html">Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index.html">Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_apidoc/modules.html">pyamr</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyamr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples with AMR indexes</a> &raquo;</li>
        
      <li>SARI - Clustermap (by specimen)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/_examples/indexes/plot_clustermap_02.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-indexes-plot-clustermap-02-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="sari-clustermap-by-specimen">
<span id="sphx-glr-examples-indexes-plot-clustermap-02-py"></span><h1>SARI - Clustermap (by specimen)<a class="headerlink" href="#sari-clustermap-by-specimen" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Explain…</p>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="Antibiogram (clustered) - BLDCUL" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_clustermap_02_001.png" />
</li>
<li><img alt="Antibiogram (clustered) - SPTCUL" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_clustermap_02_002.png" />
</li>
<li><img alt="Antibiogram (clustered) - URICUL" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_clustermap_02_003.png" />
</li>
<li><img alt="Antibiogram (clustered) - URNCUL" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_clustermap_02_004.png" />
</li>
<li><img alt="Antibiogram (clustered) - WOUCUL" class="sphx-glr-multi-img" src="../../_images/sphx_glr_plot_clustermap_02_005.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Data:
              date_received         date_outcome LastActDateODBC  patient_id laboratory_number  ... sensitivity microorganism_genus microorganism_specie  microorganism_gram_type antimicrobial_class
0       2020-04-24 18:09:00  2020-04-27 00:00:00      27/04/2020           0          F1394192  ...   sensitive            coliform                  NaN                      NaN                 NaN
1       2020-04-24 18:09:00  2020-04-27 00:00:00      27/04/2020           0          F1394192  ...   sensitive            coliform                  NaN                      NaN      cephalosporins
2       2020-04-24 18:09:00  2020-04-27 00:00:00      27/04/2020           0          F1394192  ...   sensitive            coliform                  NaN                      NaN    fluoroquinolones
3       2020-04-24 18:09:00  2020-04-27 00:00:00      27/04/2020           0          F1394192  ...   sensitive            coliform                  NaN                      NaN     aminoglycosides
4       2020-04-24 18:09:00  2020-04-27 00:00:00      27/04/2020           0          F1394192  ...   sensitive            coliform                  NaN                      NaN                 NaN
...                     ...                  ...             ...         ...               ...  ...         ...                 ...                  ...                      ...                 ...
124640  2021-01-18 16:09:00  2021-01-22 00:00:00      2021-01-22        7785           X873071  ...         NaN         citrobacter                  NaN                      NaN          meropenems
124641  2021-01-18 16:09:00  2021-01-22 00:00:00      2021-01-22        7785           X873071  ...         NaN         citrobacter                  NaN                      NaN                 NaN
124642  2021-01-18 16:09:00  2021-01-22 00:00:00      2021-01-22        7785           X873071  ...         NaN         citrobacter                  NaN                      NaN         penicillins
124643  2021-01-18 16:09:00  2021-01-22 00:00:00      2021-01-22        7785           X873071  ...         NaN         citrobacter                  NaN                      NaN                 NaN
124644  2021-01-18 16:09:00  2021-01-22 00:00:00      2021-01-22        7785           X873071  ...         NaN         citrobacter                  NaN                      NaN     aminoglycosides

[124645 rows x 22 columns]

Columns:
Index([&#39;date_received&#39;, &#39;date_outcome&#39;, &#39;LastActDateODBC&#39;, &#39;patient_id&#39;, &#39;laboratory_number&#39;, &#39;specimen_code&#39;, &#39;specimen_name&#39;, &#39;specimen_description&#39;, &#39;microorganism_piece_counter&#39;, &#39;microorganism_code&#39;, &#39;microorganism_name&#39;, &#39;antimicrobial_code&#39;, &#39;antimicrobial_name&#39;, &#39;sensitivity_method&#39;,
       &#39;sensitivity_code&#39;, &#39;mic&#39;, &#39;reported&#39;, &#39;sensitivity&#39;, &#39;microorganism_genus&#39;, &#39;microorganism_specie&#39;, &#39;microorganism_gram_type&#39;, &#39;antimicrobial_class&#39;],
      dtype=&#39;object&#39;)
SARI (overall):
sensitivity                                          hide  highly resistant  intermediate  not determined  resistant  sensitive  freq  sari
specimen_code microorganism_code antimicrobial_code
ASFCUL        CALB               AAMPH                0.0               0.0           0.0             0.0        0.0        3.0   3.0   0.0
                                 AAND                 0.0               0.0           0.0             0.0        0.0        3.0   3.0   0.0
                                 AFLUZ                0.0               0.0           0.0             0.0        0.0        3.0   3.0   0.0
                                 AITR                 0.0               0.0           0.0             0.0        0.0        3.0   3.0   0.0
                                 AMF                  0.0               0.0           0.0             0.0        0.0        3.0   3.0   0.0
...                                                   ...               ...           ...             ...        ...        ...   ...   ...
WOUCUL        PROTE              AERT                 0.0               0.0           0.0             0.0        0.0        1.0   1.0   0.0
                                 AFOX                 0.0               0.0           0.0             0.0        0.0        1.0   1.0   0.0
                                 ATAZ                 0.0               0.0           0.0             0.0        0.0        1.0   1.0   0.0
                                 ATEM                 0.0               0.0           0.0             0.0        0.0        1.0   1.0   0.0
              PANA               AMTZ                 0.0               0.0           0.0             2.0        0.0        1.0   3.0   0.0

[7656 rows x 8 columns]
Cultures:
specimen_code
URNCUL    19714.0
WOUCUL    12848.0
BLDCUL    12563.0
SPTCUL     8615.0
URICUL     7690.0
TIPCUL     3842.0
TISCUL     3597.0
MNGCUL     3171.0
ITUCUL     2631.0
NEOCUL     2016.0
BALCUL     1866.0
PSWCUL     1649.0
CROCUL     1521.0
VAGCUL     1401.0
BFLCUL     1276.0
SKNCUL     1189.0
ETTCUL      990.0
LVSCUL      875.0
GNGCUL      846.0
DRFCUL      823.0
EARCUL      721.0
PUSCUL      656.0
EYECUL      568.0
PDFCUL      318.0
FBCUL       304.0
MRSCUL      283.0
THRCUL      258.0
CSCCUL      257.0
ASFCUL      227.0
JFLCUL      210.0
NOSCUL      183.0
SEMCUL      122.0
CSFCUL      109.0
NPACUL      108.0
GLNCUL      104.0
PLFCUL      103.0
MTHCUL       75.0
IUDCUL       61.0
CLCUL        60.0
BILCUL       51.0
FAECUL       34.0
URECUL       32.0
WICCUL       25.0
PNCUL        13.0
FSTCUL       11.0
Name: freq, dtype: float64



Data (BLDCUL)
antimicrobial_code                                AAMI        AAZT           ACAZ             ACIP       ACLA  ...        ATEM          ATET          ATIG            ATOB         AVAN
antimicrobial_class                    aminoglycosides monobactams cephalosporins fluoroquinolones macrolides  ... penicillins tetracyclines tetracyclines aminoglycosides glycopeptide
microorganism_code microorganism_genus                                                                         ...
ABAU               acinetobacter                     0           0              0              100          0  ...           0             0             0               0            0
ABREVI             brevibacterium                    0           0              0                0          0  ...           0             0             0               0            0
ACAV               aeromonas                         0           0              0                0          0  ...           0             0             0               0            0
ACHRO              achromobacter                   100           0            100              100          0  ...           0             0             0               0            0
ACINE              acinetobacter                     0           0              0                0          0  ...           0             0             0               0            0
...                                                ...         ...            ...              ...        ...  ...         ...           ...           ...             ...          ...
SSAL               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
SSAN               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
STAPH              staphylococcus                    0           0              0                0          0  ...           0             0             0               0            0
STREP              streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
SVES               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0

[72 rows x 26 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (SPTCUL)
antimicrobial_code                                AAMI        AAZT           ACAZ             ACIP       ACLA  ...        ATEM          ATET          ATIG            ATOB         AVAN
antimicrobial_class                    aminoglycosides monobactams cephalosporins fluoroquinolones macrolides  ... penicillins tetracyclines tetracyclines aminoglycosides glycopeptide
microorganism_code microorganism_genus                                                                         ...
ABAU               acinetobacter                     0         100            100               50          0  ...         100             0             0               0            0
ACINE              acinetobacter                     0           0              0               66          0  ...           0             0             0               0            0
BHSB               beta-haemolytic                   0           0              0                0          0  ...           0            66             0               0            0
CFRE               citrobacter                       0          14             10                0          0  ...           0             0             0               0            0
CKOS               citrobacter                      14           0              8                0          0  ...          16             0            14               0            0
CSTR               corynebacterium                   0           0              0              100          0  ...           0            71             0               0            0
DACI               delftia                         100         100              0               50          0  ...           0             0             0               0            0
EASB               enterobacter                      0           0              0                0          0  ...           0             0             0               0            0
ECLO               enterobacter                      0          11             13                0          0  ...          16             0             7               0            0
ECOL               escherichia                       9          33             27               39          0  ...           4             0             1               0            0
EFAM               enterococcus                      0           0              0                0          0  ...           0             0             0               0           50
EFAS               enterococcus                      0           0              0                0          0  ...           0             0             0               0            0
ENTB               enterobacter                     50          50             25                0          0  ...          25             0             0               0            0
ENTC               enterococcus                      0           0              0                0          0  ...           0             0             0               0            0
HAEMO              haemophilus                       0           0              0                0        100  ...           0           100             0               0            0
HALV               hafnia                            0           0              0                0          0  ...           0             0             0               0            0
HINF               haemophilus                       0           0              0                0         88  ...           0             0             0               0            0
HPIN               haemophilus                       0           0              0                0        100  ...           0            33             0               0            0
KAER               klebsiella                        6          58             50               11          0  ...          16             0             6               0            0
KLEBS              klebsiella                        0           0              0                0          0  ...           0             0             0               0            0
KOXY               klebsiella                        0           0              0                0          0  ...           0             0             0               0            0
KPNE               klebsiella                        4          42             39               28          0  ...          11             0            14               0            0
MCAT               moraxella                         0           0              0                0         37  ...           0            22             0               0            0
MMOR               morganella                        0           0              0               50          0  ...          25             0            33               0            0
PAER               pseudomonas                       6          23             18               17          0  ...           0             0             0               9            0
PMIR               proteus                          20          25             16               33          0  ...          16             0            80               0            0
PSEUD              pseudomonas                       0          50              0                0          0  ...           0             0             0               0            0
RORN               raoultella                        0           0              0                0          0  ...          33             0             0               0            0
SANG               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
SAUR               staphylococcus                    0           0              0              100          0  ...           0             8             0               0            0
SERRA              serratia                          0           0              0                0          0  ...           0             0             0               0            0
SLIQ               serratia                          0           0              0                0          0  ...           0             0             0               0            0
SMAL               stenotrophomonas                  0           0              0                0          0  ...           0             0             0               0            0
SMAR               serratia                          2           2              0               14          0  ...          24             0             5               0            0
SMIL               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
SODOR              serratia                          0           0              0                0          0  ...           0             0             0               0            0
SPNE               streptococcus                     0           0              0                0          0  ...           0            35             0               0            0
STAPH              staphylococcus                    0           0              0                0          0  ...           0             0             0               0            0

[38 rows x 26 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (URICUL)
antimicrobial_code                                AAMI        AAZT           ACAZ          ACELX             ACIP  ...         ATEI        ATEM          ATET            ATOB         AVAN
antimicrobial_class                    aminoglycosides monobactams cephalosporins cephalosporins fluoroquinolones  ... glycopeptide penicillins tetracyclines aminoglycosides glycopeptide
microorganism_code microorganism_genus                                                                             ...
ABAU               acinetobacter                    20           0              0              0               40  ...            0           0             0               0            0
ACINE              acinetobacter                     0           0              0              0               21  ...            0           0             0               0            0
ALWO               acinetobacter                     0           0              0              0               66  ...            0           0             0               0            0
AXYL               achromobacter                   100         100            100              0              100  ...            0           0             0             100            0
BHS                beta-haemolytic                   0           0              0              0                0  ...            0           0           100               0            0
BHSB               beta-haemolytic                   0           0              0              0                0  ...            0           0            83               0            0
BHSCG              beta-haemolytic                   0           0              0              0                0  ...            0           0            50               0            0
CFRE               citrobacter                       0           0              0             50                0  ...            0          50             0               0            0
CITRO              citrobacter                       0           0              0              0                0  ...            0           0             0               0            0
CKOS               citrobacter                       0           0              0            100                0  ...            0           0             0               0            0
COLIF              coliform                          0           0              0             36                9  ...            0          40             0               0            0
EASB               enterobacter                      0           0              0            100                0  ...            0           0             0               0            0
ECLO               enterobacter                      0           0             20             88                0  ...            0          37             0               0            0
ECOL               escherichia                       8           0             38             26               31  ...            0          42             0               0            0
EFAM               enterococcus                      0           0              0              0                0  ...           18           0             0               0            9
EFAS               enterococcus                      0           0              0              0                0  ...            0           0             0               0            0
EGAL               enterococcus                      0           0              0              0                0  ...            0           0             0               0            0
ENTB               enterobacter                      0           0            100            100                0  ...            0          25             0               0            0
ENTC               enterococcus                      0           0              0              0                0  ...           16           0             0               0           15
KAER               klebsiella                        0           0             50            100                0  ...            0          42             0               0            0
KLEBS              klebsiella                        0           0              0              0                0  ...            0           0             0               0            0
KOXY               klebsiella                        0           0              0             33                0  ...            0          50             0               0            0
KPNE               klebsiella                       50           0             80             80               60  ...            0          54             0               0            0
MMOR               morganella                        0           0              0            100                0  ...            0          22             0               0            0
PAER               pseudomonas                       0          75              6              0                9  ...            0           0             0               0            0
PMIR               proteus                          50           0              0              0               14  ...            0          20             0               0            0
PPUT               pseudomonas                       0           0            100              0                0  ...            0           0             0               0            0
PRET               providencia                       0           0              0            100                0  ...            0           0             0               0            0
PROTE              proteus                           0           0              0              0                0  ...            0           0             0               0            0
PSEUD              pseudomonas                       0           0              0              0                0  ...            0           0             0               0            0
PSTUA              providencia                       0           0              0            100                0  ...            0           0             0               0            0
RORN               raoultella                        0           0              0              0                0  ...            0           0             0               0            0
SAUR               staphylococcus                    0           0              0              0                0  ...            0           0            18               0            0
SERRA              serratia                          0           0              0              0                0  ...            0         100             0               0            0
SLUG               staphylococcus                    0           0              0              0                0  ...            0           0             0               0            0
SMAL               stenotrophomonas                  0           0              0              0                0  ...            0           0             0               0            0
SMAR               serratia                          0           0              0            100               25  ...            0          14             0               0            0
STREP              streptococcus                     0           0              0              0                0  ...            0           0             0               0            0

[38 rows x 24 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (URNCUL)
antimicrobial_code                                AAMI        AAZT           ACAZ          ACELX             ACIP  ...        ATEM          ATET          ATIG            ATOB         AVAN
antimicrobial_class                    aminoglycosides monobactams cephalosporins cephalosporins fluoroquinolones  ... penicillins tetracyclines tetracyclines aminoglycosides glycopeptide
microorganism_code microorganism_genus                                                                             ...
ABAU               acinetobacter                     0           0              0            100                0  ...           0             0             0               0            0
ACINE              acinetobacter                     0           0              0              0               83  ...           0             0             0               0            0
ALWO               acinetobacter                     0           0              0              0                0  ...           0             0             0               0            0
BFRA               bacteroides                       0           0              0              0                0  ...           0             0             0               0            0
BHS                beta-haemolytic                   0           0              0              0                0  ...           0           100             0               0            0
BHSB               beta-haemolytic                   0           0              0              0                0  ...           0            87             0               0            0
BHSCG              beta-haemolytic                   0           0              0              0                0  ...           0             0             0               0            0
BHSG               beta-haemolytic                   0           0              0              0                0  ...           0             0             0               0            0
CAMA               citrobacter                       0           0            100            100                0  ...           0             0             0               0            0
CBRA               citrobacter                       0           0             33            100                0  ...           0             0             0               0            0
CFRE               citrobacter                       7           0              7            100               14  ...           7             0             0               0            0
CITRO              citrobacter                       0           0              0            100                0  ...           0             0             0               0            0
CKOS               citrobacter                       0           0              0              0                0  ...         100             0             0               0            0
CNS                staphylococcus                    0           0              0              0                0  ...           0             0             0               0            0
COLIF              coliform                          9           0             20              3                3  ...          20             0             0               0            0
EASB               enterobacter                      0           0              0            100                0  ...         100             0             0               0            0
ECLO               enterobacter                     15           0             43            100               28  ...          42             0             0               0            0
ECOL               escherichia                       4           0             64             17               22  ...          27             0             0               0            0
EFAM               enterococcus                      0           0              0              0                0  ...           0             0           100               0           33
EFAS               enterococcus                      0           0              0              0                0  ...           0             0             0               0           14
ENTB               enterobacter                      0           0             20            100               16  ...          50             0             0               0            0
ENTC               enterococcus                      0           0              0              0                0  ...           0             0            14               0            6
HALV               hafnia                            0           0              0            100                0  ...           0             0             0               0            0
KAER               klebsiella                        0           0             33            100                0  ...          40             0             0               0            0
KLEBS              klebsiella                        0           0              0              0                0  ...           0             0             0               0            0
KOXY               klebsiella                        0           0            100             71               57  ...          75             0             0               0            0
KPNE               klebsiella                        7           0             77             69               67  ...          30             0             0               0            0
MMOR               morganella                        0           0             11            100                7  ...          26             0             0               0            0
PAER               pseudomonas                       1          14              7              0                9  ...           0             0             0               5            0
PMIR               proteus                          13           0              6              3                6  ...          10             0             0               0            0
PPUT               pseudomonas                       0           0              0              0                0  ...           0             0             0               0            0
PRET               providencia                       0           0              0            100                0  ...           0             0             0               0            0
PROTE              proteus                           0           0              0             25                0  ...           0             0             0               0            0
PSEUD              pseudomonas                       0         100             36              0                0  ...           0             0             0               0            0
PSTUA              providencia                       0           0              0              0                0  ...           0             0             0               0            0
PVUL               proteus                           0           0              0            100                0  ...         100             0             0               0            0
QMIXP              mixed                             0           0              0            100              100  ...           0             0             0               0            0
SANG               streptococcus                     0           0              0              0                0  ...           0             0             0               0            0
SAUR               staphylococcus                    0           0              0              0                0  ...           0            19             0               0            0
SBOV               streptococcus                     0           0              0              0                0  ...           0             0             0               0            0
SEPI               staphylococcus                    0           0              0              0                0  ...           0             0             0               0            0
SHAEM              staphylococcus                    0           0              0              0                0  ...           0            66             0               0            0
SMAL               stenotrophomonas                  0           0              0              0                0  ...           0             0             0               0            0
SMAR               serratia                          0           0              0            100               13  ...          80             0             0               0            0

[44 rows x 26 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap




Data (WOUCUL)
antimicrobial_code                                AAMI        AAZT           ACAZ             ACIP       ACLI  ...        ATEM          ATET          ATIG            ATOB         AVAN
antimicrobial_class                    aminoglycosides monobactams cephalosporins fluoroquinolones macrolides  ... penicillins tetracyclines tetracyclines aminoglycosides glycopeptide
microorganism_code microorganism_genus                                                                         ...
ABAU               acinetobacter                   100           0              0              100          0  ...           0             0             0               0            0
ACINE              acinetobacter                     0           0              0              100          0  ...           0             0             0               0            0
AEROM              aeromonas                         0           0              0                0          0  ...           0             0             0               0            0
AFAE               alcaligenes                       0         100              0                0          0  ...         100             0             0               0            0
ALWO               acinetobacter                     0           0              0              100          0  ...           0             0             0               0            0
AXYL               achromobacter                   100           0              0              100          0  ...           0             0             0               0            0
BCER               bacillus                          0           0              0                0        100  ...           0             0             0               0            0
BHS                beta-haemolytic                   0           0              0                0          0  ...           0             0             0               0          100
BHSA               beta-haemolytic                   0           0              0                0         25  ...           0            50             0               0            0
BHSB               beta-haemolytic                   0           0              0                0         30  ...           0            80             0               0            0
BHSCG              beta-haemolytic                   0           0              0                0         21  ...           0            43             0               0            0
CBRA               citrobacter                       0           0              0                0          0  ...           0             0             0               0            0
CFRE               citrobacter                       0           0              0                0          0  ...           0             0             0               0            0
CITRO              citrobacter                       0           0              0                0          0  ...           0             0             0               0            0
CKOS               citrobacter                       0           0              0                0          0  ...           0             0             0               0            0
COLIF              coliform                         16          33             11               11          0  ...           5             0             0               0            0
CORYN              corynebacterium                   0           0              0               40         60  ...           0             0             0               0            0
CSTR               corynebacterium                   0           0              0               90         90  ...           0            70             0               0            0
ECLO               enterobacter                      7          30             20               13          0  ...          10             0            33               0            0
ECOL               escherichia                      10          44             24               31          0  ...           8             0             3               0            0
EFAM               enterococcus                      0           0              0                0          0  ...           0             0             0               0           30
EFAS               enterococcus                      0           0              0                0          0  ...           0             0            24               0            7
ENTB               enterobacter                    100         100             50               50          0  ...          50             0             0               0            0
ENTC               enterococcus                      0           0              0                0          0  ...           0             0             0               0           66
HPIN               haemophilus                       0           0              0                0          0  ...           0             0             0               0            0
KAER               klebsiella                        0         100             11                0          0  ...          10             0             0               0            0
KLEBS              klebsiella                        0           0              0                0          0  ...           0             0             0               0            0
KOXY               klebsiella                        0           0              0                0          0  ...           0             0             0               0            0
KPNE               klebsiella                       10          68             50               47          0  ...          11             0             0               0            0
MMOR               morganella                        0           0             20                0          0  ...          20             0             0               0            0
PAER               pseudomonas                       0          27              8               12          0  ...           0             0             0               6            0
PANA               peptostreptococcus                0           0              0                0          0  ...           0             0             0               0            0
PBIV               prevotella                        0           0              0                0          0  ...           0             0             0               0            0
PMIR               proteus                          14           0              0               29          0  ...           0             0            85               0            0
PMUL               pasteurella                       0           0              0                0          0  ...           0             0             0               0            0
PORI               pseudomonas                       0           0              0                0          0  ...           0             0             0               0            0
PRET               providencia                       0           0              0                0          0  ...           0             0             0               0            0
PROTE              proteus                           0           0              0                0          0  ...           0             0             0               0            0
PSEUD              pseudomonas                       0           0             12                0          0  ...           0             0             0               0            0
PSTU               pseudomonas                       0           0              0                0          0  ...           0             0             0               0            0
QMAN               mixed                             0           0              0                0          0  ...           0             0             0               0            0
RORN               raoultella                        0           0              0                0          0  ...           0             0             0               0            0
SALMO              salmonella                        0           0              0                0          0  ...           0             0             0               0            0
SANG               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
SAUR               staphylococcus                    0           0              0               26         23  ...           0             7             0               0            0
SEPI               staphylococcus                    0           0              0                0        100  ...           0            50             0               0            0
SLUG               staphylococcus                    0           0              0                0         66  ...           0             0             0               0            0
SMAL               stenotrophomonas                  0           0              0                0          0  ...           0             0             0               0            0
SMAR               serratia                          0           0              5                0          0  ...          23             0            50               0            0
SMIL               streptococcus                     0           0              0                0          0  ...           0             0             0               0            0
STAPH              staphylococcus                    0           0              0                0          0  ...           0             0             0               0            0
STREP              streptococcus                     0           0              0                0         33  ...           0             0             0               0            0

[52 rows x 25 columns]
c:\users\kelda\desktop\repositories\virtualenvs\venvpy39-datablend\lib\site-packages\seaborn\matrix.py:1216: UserWarning:

``square=True`` ignored in clustermap
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># Libraries</span>
 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
 <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
 <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

 <span class="c1"># Import specific libraries</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.sari</span> <span class="kn">import</span> <span class="n">SARI</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.freq</span> <span class="kn">import</span> <span class="n">Frequency</span>
 <span class="kn">from</span> <span class="nn">pyamr.datasets.load</span> <span class="kn">import</span> <span class="n">make_susceptibility</span>

 <span class="c1"># -------------------------</span>
 <span class="c1"># Configuration</span>
 <span class="c1"># -------------------------</span>
 <span class="c1"># Configure seaborn style (context=talk)</span>
 <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

 <span class="c1"># Set matplotlib</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
 <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>

 <span class="c1"># Pandas configuration</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
 <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

 <span class="c1"># Numpy configuration</span>
 <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

 <span class="c1"># ------------------</span>
 <span class="c1"># Methods</span>
 <span class="c1"># ------------------</span>
 <span class="k">def</span> <span class="nf">get_category_colors</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hls&#39;</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;This method creates the colors for the different elements in</span>
<span class="sd">     categorical feature vector.</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     values : array-like</span>
<span class="sd">         The vector with the categorical values</span>

<span class="sd">     cmap: string-like</span>
<span class="sd">         The colormap to use</span>

<span class="sd">     default: string-like</span>
<span class="sd">         The color to be used for the first value. Note that this</span>
<span class="sd">         value needs to appear first on the the sorted list, as such</span>
<span class="sd">         it is recommended to set is as _default.</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="c1"># Get categories</span>
     <span class="n">categories</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
     <span class="c1"># Get unique elements</span>
     <span class="n">unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
     <span class="c1"># Create the palette</span>
     <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="n">unique</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
     <span class="c1"># Create mappers from category to color</span>
     <span class="n">mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unique</span><span class="p">),</span> <span class="n">palette</span><span class="p">))</span>
     <span class="c1"># Create list with colors for each category</span>
     <span class="n">colors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapper</span><span class="p">)</span>
     <span class="c1"># Return</span>
     <span class="k">return</span> <span class="n">colors</span>


 <span class="c1"># ------------------------</span>
 <span class="c1"># Methods</span>
 <span class="c1"># ------------------------</span>
 <span class="k">def</span> <span class="nf">create_mapper</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">column_key</span><span class="p">,</span> <span class="n">column_value</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot;This method constructs a mapper</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     dataframe: dataframe-like</span>
<span class="sd">       The dataframe from which the columns are extracted</span>

<span class="sd">     column_key: string-like</span>
<span class="sd">       The name of the column with the values for the keys of the mapper</span>

<span class="sd">     column_value: string-like</span>
<span class="sd">       The name of the column with the values for the values of the mapper</span>

<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     dictionary</span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[[</span><span class="n">column_key</span><span class="p">,</span> <span class="n">column_value</span><span class="p">]]</span>
     <span class="n">dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
     <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="n">column_key</span><span class="p">],</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">column_value</span><span class="p">]))</span>

 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Load data</span>
 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Load data</span>
 <span class="n">data</span> <span class="o">=</span> <span class="n">make_susceptibility</span><span class="p">()</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Columns:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Compute SARI</span>
 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Libraries</span>
 <span class="kn">from</span> <span class="nn">pyamr.core.sari</span> <span class="kn">import</span> <span class="n">SARI</span>

 <span class="c1"># Create sari instance</span>
 <span class="n">sari</span> <span class="o">=</span> <span class="n">SARI</span><span class="p">(</span><span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;microorganism_code&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;antimicrobial_code&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sensitivity&#39;</span><span class="p">])</span>

 <span class="c1"># Compute SARI overall</span>
 <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">sari</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
     <span class="n">return_frequencies</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SARI (overall):&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">sari_overall</span><span class="p">)</span>


 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Plot</span>
 <span class="c1"># -------------------------------------------</span>
 <span class="c1"># Reset</span>
 <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

 <span class="c1"># Count records per specimen</span>
 <span class="n">specimen_count</span> <span class="o">=</span> <span class="n">sari_overall</span> \
     <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> \
     <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

 <span class="c1"># Show</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cultures:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">specimen_count</span><span class="p">)</span>

 <span class="c1"># Filter</span>
 <span class="n">sari_overall</span> <span class="o">=</span> <span class="n">sari_overall</span><span class="p">[</span><span class="n">sari_overall</span> \
     <span class="o">.</span><span class="n">specimen_code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span> \
         <span class="n">specimen_count</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">5</span><span class="p">])]</span>

 <span class="c1"># Loop</span>
 <span class="k">for</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">sari_overall</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;specimen_code&#39;</span><span class="p">):</span>

     <span class="c1"># -------------------------------</span>
     <span class="c1"># Create matrix</span>
     <span class="c1"># -------------------------------</span>
     <span class="c1"># Create mappers</span>
     <span class="n">abx_map</span> <span class="o">=</span> <span class="n">create_mapper</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;antimicrobial_code&#39;</span><span class="p">,</span> <span class="s1">&#39;antimicrobial_class&#39;</span><span class="p">)</span>
     <span class="n">org_map</span> <span class="o">=</span> <span class="n">create_mapper</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;microorganism_code&#39;</span><span class="p">,</span> <span class="s1">&#39;microorganism_genus&#39;</span><span class="p">)</span>

     <span class="c1"># Filter</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
     <span class="n">matrix</span><span class="p">[</span><span class="s1">&#39;microorganism_genus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">microorganism_code</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">org_map</span><span class="p">)</span>
     <span class="n">matrix</span><span class="p">[</span><span class="s1">&#39;antimicrobial_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">antimicrobial_code</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">abx_map</span><span class="p">)</span>
     <span class="c1">#matrix = matrix[matrix.freq &gt; 100]</span>

     <span class="c1"># Pivot table</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span>
          <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;microorganism_code&#39;</span><span class="p">,</span> <span class="s1">&#39;microorganism_genus&#39;</span><span class="p">],</span>
          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;antimicrobial_code&#39;</span><span class="p">,</span> <span class="s1">&#39;antimicrobial_class&#39;</span><span class="p">],</span>
          <span class="n">values</span><span class="o">=</span><span class="s1">&#39;sari&#39;</span><span class="p">)</span>

     <span class="c1"># Convert to percent</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span> <span class="o">*</span> <span class="mi">100</span>

     <span class="c1"># Create mask</span>
     <span class="n">mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

     <span class="c1"># Fill missing (error when computing distance)</span>
     <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">)</span>

     <span class="c1"># Show</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">Data (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

     <span class="c1"># Create colormap</span>
     <span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">desat</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

     <span class="c1"># Row and col colors</span>
     <span class="n">col_colors</span> <span class="o">=</span> <span class="n">get_category_colors</span><span class="p">(</span> \
         <span class="n">index</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     <span class="n">row_colors</span> <span class="o">=</span> <span class="n">get_category_colors</span><span class="p">(</span> \
         <span class="n">index</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

     <span class="c1"># .. note: It is possible to also pass kwargs that would</span>
     <span class="c1">#          be used by sns.heatmap function (annot, fmt,</span>
     <span class="c1">#          annot_kws, ...</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="c1"># Plot cluster map</span>
         <span class="n">grid</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">clustermap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
             <span class="n">method</span><span class="o">=</span><span class="s1">&#39;centroid&#39;</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
             <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">row_colors</span><span class="o">=</span><span class="n">row_colors</span><span class="p">,</span> <span class="n">col_colors</span><span class="o">=</span><span class="n">col_colors</span><span class="p">)</span>
     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

     <span class="c1"># Configuration</span>
     <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Antibiogram (clustered) - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">specimen</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
     <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

 <span class="c1"># Show</span>
 <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  5.126 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-indexes-plot-clustermap-02-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/79a949b38a532f0c74d942dafe98016f/plot_clustermap_02.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_clustermap_02.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/22d8dae0ef6d7a449190d6c02ab8fb46/plot_clustermap_02.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_clustermap_02.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plot_relmap_02.html" class="btn btn-neutral float-right" title="SARI - Relplot (by specimen)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_antibiogram_02.html" class="btn btn-neutral float-left" title="SARI - Antibiogram (by specimen)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Bernard Hernandez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>