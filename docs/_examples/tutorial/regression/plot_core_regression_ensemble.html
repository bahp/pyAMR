

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Regression - WLSARMA &mdash; pyamr 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Regression - SARIMAX" href="plot_core_regression_sarimax.html" />
    <link rel="prev" title="Regression - ARIMA" href="plot_core_regression_arima.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> pyamr
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/registries.html">Registries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/todo.html">Future Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Galleries</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#guide">Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#indexes">Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#metrics">Metrics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#regression">Regression</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plot_core_regression_arima.html">Regression - ARIMA</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Regression - WLSARMA</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_core_regression_sarimax.html">Regression - SARIMAX</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_core_regression_theilsens.html">Regression - Theil-Sen</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_core_regression_wls.html">Regression - WLS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../indexes/index.html">Examples with indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../forecasting/index.html">Examples with TSA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reports/index.html">Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization/index.html">Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_apidoc/modules.html">pyamr</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyamr</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Tutorial</a> &raquo;</li>
        
      <li>Regression - WLSARMA</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/_examples/tutorial/regression/plot_core_regression_ensemble.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-tutorial-regression-plot-core-regression-ensemble-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="regression-wlsarma">
<span id="sphx-glr-examples-tutorial-regression-plot-core-regression-ensemble-py"></span><h1>Regression - WLSARMA<a class="headerlink" href="#regression-wlsarma" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Not working yet!</p>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;\n# Import class.\nimport numpy as np\nimport pandas as pd\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nimport statsmodels.robust.norms as norms\n\nfrom statsmodels.tsa.arima_model import ARIMA\n\n\n# import weights.\nfrom pyamr.datasets.load import make_timeseries\nfrom pyamr.metrics.weights import SigmoidA\nfrom pyamr.core.regression.wls import WLSWrapper\nfrom pyamr.core.regression.wlsarma import WLSARMAWrapper\n\n# Matplotlib options\nmpl.rc(&#39;legend&#39;, fontsize=6)\nmpl.rc(&#39;xtick&#39;, labelsize=6)\nmpl.rc(&#39;ytick&#39;, labelsize=6)\n\n# Set pandas configuration.\npd.set_option(&#39;display.max_colwidth&#39;, 14)\npd.set_option(&#39;display.width&#39;, 150)\npd.set_option(&#39;display.precision&#39;, 4)\n\n# Create timeseries data\nx, y, f = make_timeseries()\n\n# Create method to compute weights from frequencies\nW = SigmoidA(r=200, g=0.5, offset=0.0, scale=1.0)\n\n# Note that the function fit will call M.weights(weights) inside and will\n# store the M converter in the instance. Therefore, the code execute is\n# equivalent to &lt;weights=M.weights(f)&gt; with the only difference being that\n# the weight converter is not saved.\nwls = WLSWrapper(estimator=sm.WLS).fit(     exog=x, endog=y, trend=&#39;c&#39;, weights=f,\n    W=W, missing=&#39;raise&#39;)\n\n# Create WLS + ARIMA model.\nwlsarima = WLSARMAWrapper().fit(endog=y, exog=x, weights=f,\n    wls_kwargs={&#39;W&#39;: W, &#39;trend&#39;: &#39;c&#39;, &#39;missing&#39;: &#39;raise&#39;},\n     arima_kwargs={&#39;exog&#39;: None, &#39;max_ar&#39;: 1,\n                   &#39;max_ma&#39;: 1, &#39;max_d&#39;: 0, &#39;ic&#39;: &#39;bic&#39;,\n                   &#39;order&#39;: (1,0,0)})\n\npred1 = wlsarima.get_prediction(start=None, end=140)\npred2 = wls.get_prediction(start=None, end=140)\n\nendog = getattr(wlsarima._wls, &#39;endog&#39;)\nexog = getattr(wlsarima._wls, &#39;exog&#39;)[:, 1]\n\n# Create figures.\nfig, axes = plt.subplots(1, 2, figsize=(10, 4), sharey=True, sharex=True)\n# Plot observations.\naxes[0].plot(exog, endog, color=&#39;#A6CEE3&#39;, alpha=0.5, marker=&#39;o&#39;,\n             markeredgecolor=&#39;k&#39;, markeredgewidth=0.5,\n             markersize=5, linewidth=0.75, label=&#39;Observed&#39;)\naxes[0].plot(pred1[0, :], pred1[1, :], color=&#39;#39ac73&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=&#39;WLSARMA&#39;)\naxes[1].plot(pred2[0, :], pred2[1, :], color=&#39;r&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=&#39;WLS&#39;)\n\nplt.legend()\nplt.show()\n\nimport sys\n\nsys.exit()\n\n# Create WLS + SARIMAX model.\nwlssarimax = WLSARMAWrapper().fit(endog=y, exog=x, weights=f,\n                                  wls_kwargs={&#39;W&#39;: W, &#39;trend&#39;: &#39;c&#39;, &#39;missing&#39;: &#39;raise&#39;},\n                                  sarimax_kwargs={&#39;exog&#39;: None, &#39;ic&#39;: &#39;bic&#39;, &#39;max_ar&#39;: 1, &#39;max_ma&#39;: 1, &#39;max_d&#39;: 0,\n                                                  &#39;max_P&#39;: 0, &#39;max_D&#39;: 0, &#39;max_Q&#39;: 0, &#39;list_s&#39;: [12]})\n\n# Create best SARIMAX model\nmodels, sarimax = SARIMAXWrapper().fit(endog=y, ic=&#39;bic&#39;,\n                                       max_ar=1, max_ma=1, max_d=1,\n                                       max_P=0, max_D=0, max_Q=0,\n                                       list_s=[0], return_fits=True)\n\n# Print series.\nprint(wlsarima.as_series())\n\n# Print summaries.\nprint(wlsarima.as_summary())\nprint(wlssarimax.as_summary())\nprint(wlsarima._arma.as_summary())\nprint(wlssarimax._arma.as_summary())\n\n# -----------------\n# Save &amp; Load\n# -----------------\n# File location\nfname_wlsarima = &#39;../../examples/saved/wlsarima-sample.pickle&#39;\nfname_wlssarimax = &#39;../../examples/saved/wlssarimax-sample.pickle&#39;\n\n# Save\nwlsarima.save(fname=fname_wlsarima)\n# wlssarimax.save(fname=fname_wlssarimax) (zstatespace can&#39;t be pickled)\n\n# Load\nwlsarima = WLSARMAWrapper().load(fname=fname_wlsarima)\n# wlssarimax = WLSARMAWrapper().load(fname=fname_wlssarimax)\n\n# -----------------\n#  Predictions\n# -----------------\n# Variables.\nstart, end = None, None\n\n# Compute predictions.\npreds_wls = wlsarima.get_prediction(start=start, end=end, ptype=&#39;wls&#39;)\npreds_arima = wlsarima.get_prediction(start=start, end=end, ptype=&#39;arma&#39;)\npreds_sarimax = wlssarimax.get_prediction(start=start, end=end, ptype=&#39;arma&#39;)\npreds_wlsarima = wlsarima.get_prediction(start=start, end=end)\npreds_wlssarimax = wlssarimax.get_prediction(start=start, end=end)\npreds_sarimax = sarimax.get_prediction(start=start, end=end)\n\n# Create figures.\nfig, axes = plt.subplots(1, 2, figsize=(10, 4))\n\n# Subplot 0\n# ---------\n# Plot observed values\nendog = getattr(wlsarima._wls, &#39;endog&#39;)\nexog = getattr(wlsarima._wls, &#39;exog&#39;)[:, 1]\naxes[0].plot(exog, endog, color=&#39;#A6CEE3&#39;, alpha=0.5, marker=&#39;o&#39;,\n             markeredgecolor=&#39;k&#39;, markeredgewidth=0.5,\n             markersize=5, linewidth=0.75, label=&#39;Observed&#39;)\n\n# Plot forecasted values (WLS-ARIMA).\naxes[0].plot(preds_wlsarima[0, :], preds_wlsarima[1, :], color=&#39;#39ac73&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=wlsarima._identifier(short=True))\n\n# Plot confidence intervals (WLS-ARIMA)\naxes[0].fill_between(preds_wlsarima[0, 3:],\n                     preds_wlsarima[2, 3:],\n                     preds_wlsarima[3, 3:],\n                     color=&#39;#39ac73&#39;, alpha=0.1)\n\n# Plot forecasted values (WLS-SARIMAX).\naxes[0].plot(preds_wlssarimax[0, :], preds_wlssarimax[1, :], color=&#39;b&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=wlssarimax._identifier(short=True))\n\n# Plot confidence intervals (WLS-SARIMAX)\naxes[0].fill_between(preds_wlssarimax[0, 3:],\n                     preds_wlssarimax[2, 3:],\n                     preds_wlssarimax[3, 3:],\n                     color=&#39;b&#39;, alpha=0.1)\n\n# Plot forecasted values and confidence intervals (SARIMAX).\naxes[0].plot(preds_sarimax[0, :], preds_sarimax[1, :], color=&#39;#FF0000&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=sarimax._identifier())\n\n# Plot confidence intervals\naxes[0].fill_between(preds_sarimax[0, 3:],\n                     preds_sarimax[2, 3:],\n                     preds_sarimax[3, 3:],\n                     color=&#39;#FF0000&#39;, alpha=0.1)\n\n# Subplot 1\n# ---------\n# Plot observed values.\naxes[1].plot(x, y, color=&#39;#A6CEE3&#39;, alpha=0.5, marker=&#39;o&#39;,\n             markeredgecolor=&#39;k&#39;, markeredgewidth=0.5,\n             markersize=5, linewidth=0.75, label=&#39;Observed&#39;)\n\n# Plot wls separately.\naxes[1].plot(preds_wls[0, :], preds_wls[1, :], color=&#39;#39ac73&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=wlsarima._wls._identifier(short=True))\n\naxes[1].fill_between(preds_wls[0, :],\n                     preds_wls[2, :],\n                     preds_wls[3, :],\n                     color=&#39;#39ac73&#39;, alpha=0.1)\n\n# Plot arma separately.\naxes[1].plot(preds_arima[0, :], preds_arima[1, :], color=&#39;#FF0000&#39;,\n             alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,\n             markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,\n             label=wlsarima._arma._identifier())\n\naxes[1].fill_between(preds_arima[0, :],\n                     preds_arima[2, :],\n                     preds_arima[3, :],\n                     color=&#39;#FF0000&#39;, alpha=0.1)\n\n# Grid\naxes[0].grid(linestyle=&#39;--&#39;, linewidth=0.35, alpha=0.5)\naxes[1].grid(linestyle=&#39;--&#39;, linewidth=0.35, alpha=0.5)\n\n# Legend\naxes[0].legend()\naxes[1].legend()\n\n# Show\nplt.show()\n&quot;
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> # Import class.</span>
<span class="sd"> import numpy as np</span>
<span class="sd"> import pandas as pd</span>
<span class="sd"> import matplotlib as mpl</span>
<span class="sd"> import matplotlib.pyplot as plt</span>
<span class="sd"> import statsmodels.api as sm</span>
<span class="sd"> import statsmodels.robust.norms as norms</span>

<span class="sd"> from statsmodels.tsa.arima_model import ARIMA</span>


<span class="sd"> # import weights.</span>
<span class="sd"> from pyamr.datasets.load import make_timeseries</span>
<span class="sd"> from pyamr.metrics.weights import SigmoidA</span>
<span class="sd"> from pyamr.core.regression.wls import WLSWrapper</span>
<span class="sd"> from pyamr.core.regression.wlsarma import WLSARMAWrapper</span>

<span class="sd"> # Matplotlib options</span>
<span class="sd"> mpl.rc(&#39;legend&#39;, fontsize=6)</span>
<span class="sd"> mpl.rc(&#39;xtick&#39;, labelsize=6)</span>
<span class="sd"> mpl.rc(&#39;ytick&#39;, labelsize=6)</span>

<span class="sd"> # Set pandas configuration.</span>
<span class="sd"> pd.set_option(&#39;display.max_colwidth&#39;, 14)</span>
<span class="sd"> pd.set_option(&#39;display.width&#39;, 150)</span>
<span class="sd"> pd.set_option(&#39;display.precision&#39;, 4)</span>

<span class="sd"> # Create timeseries data</span>
<span class="sd"> x, y, f = make_timeseries()</span>

<span class="sd"> # Create method to compute weights from frequencies</span>
<span class="sd"> W = SigmoidA(r=200, g=0.5, offset=0.0, scale=1.0)</span>

<span class="sd"> # Note that the function fit will call M.weights(weights) inside and will</span>
<span class="sd"> # store the M converter in the instance. Therefore, the code execute is</span>
<span class="sd"> # equivalent to &lt;weights=M.weights(f)&gt; with the only difference being that</span>
<span class="sd"> # the weight converter is not saved.</span>
<span class="sd"> wls = WLSWrapper(estimator=sm.WLS).fit( \</span>
<span class="sd">     exog=x, endog=y, trend=&#39;c&#39;, weights=f,</span>
<span class="sd">     W=W, missing=&#39;raise&#39;)</span>

<span class="sd"> # Create WLS + ARIMA model.</span>
<span class="sd"> wlsarima = WLSARMAWrapper().fit(endog=y, exog=x, weights=f,</span>
<span class="sd">     wls_kwargs={&#39;W&#39;: W, &#39;trend&#39;: &#39;c&#39;, &#39;missing&#39;: &#39;raise&#39;},</span>
<span class="sd">      arima_kwargs={&#39;exog&#39;: None, &#39;max_ar&#39;: 1,</span>
<span class="sd">                    &#39;max_ma&#39;: 1, &#39;max_d&#39;: 0, &#39;ic&#39;: &#39;bic&#39;,</span>
<span class="sd">                    &#39;order&#39;: (1,0,0)})</span>

<span class="sd"> pred1 = wlsarima.get_prediction(start=None, end=140)</span>
<span class="sd"> pred2 = wls.get_prediction(start=None, end=140)</span>

<span class="sd"> endog = getattr(wlsarima._wls, &#39;endog&#39;)</span>
<span class="sd"> exog = getattr(wlsarima._wls, &#39;exog&#39;)[:, 1]</span>

<span class="sd"> # Create figures.</span>
<span class="sd"> fig, axes = plt.subplots(1, 2, figsize=(10, 4), sharey=True, sharex=True)</span>
<span class="sd"> # Plot observations.</span>
<span class="sd"> axes[0].plot(exog, endog, color=&#39;#A6CEE3&#39;, alpha=0.5, marker=&#39;o&#39;,</span>
<span class="sd">              markeredgecolor=&#39;k&#39;, markeredgewidth=0.5,</span>
<span class="sd">              markersize=5, linewidth=0.75, label=&#39;Observed&#39;)</span>
<span class="sd"> axes[0].plot(pred1[0, :], pred1[1, :], color=&#39;#39ac73&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=&#39;WLSARMA&#39;)</span>
<span class="sd"> axes[1].plot(pred2[0, :], pred2[1, :], color=&#39;r&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=&#39;WLS&#39;)</span>

<span class="sd"> plt.legend()</span>
<span class="sd"> plt.show()</span>

<span class="sd"> import sys</span>

<span class="sd"> sys.exit()</span>

<span class="sd"> # Create WLS + SARIMAX model.</span>
<span class="sd"> wlssarimax = WLSARMAWrapper().fit(endog=y, exog=x, weights=f,</span>
<span class="sd">                                   wls_kwargs={&#39;W&#39;: W, &#39;trend&#39;: &#39;c&#39;, &#39;missing&#39;: &#39;raise&#39;},</span>
<span class="sd">                                   sarimax_kwargs={&#39;exog&#39;: None, &#39;ic&#39;: &#39;bic&#39;, &#39;max_ar&#39;: 1, &#39;max_ma&#39;: 1, &#39;max_d&#39;: 0,</span>
<span class="sd">                                                   &#39;max_P&#39;: 0, &#39;max_D&#39;: 0, &#39;max_Q&#39;: 0, &#39;list_s&#39;: [12]})</span>

<span class="sd"> # Create best SARIMAX model</span>
<span class="sd"> models, sarimax = SARIMAXWrapper().fit(endog=y, ic=&#39;bic&#39;,</span>
<span class="sd">                                        max_ar=1, max_ma=1, max_d=1,</span>
<span class="sd">                                        max_P=0, max_D=0, max_Q=0,</span>
<span class="sd">                                        list_s=[0], return_fits=True)</span>

<span class="sd"> # Print series.</span>
<span class="sd"> print(wlsarima.as_series())</span>

<span class="sd"> # Print summaries.</span>
<span class="sd"> print(wlsarima.as_summary())</span>
<span class="sd"> print(wlssarimax.as_summary())</span>
<span class="sd"> print(wlsarima._arma.as_summary())</span>
<span class="sd"> print(wlssarimax._arma.as_summary())</span>

<span class="sd"> # -----------------</span>
<span class="sd"> # Save &amp; Load</span>
<span class="sd"> # -----------------</span>
<span class="sd"> # File location</span>
<span class="sd"> fname_wlsarima = &#39;../../examples/saved/wlsarima-sample.pickle&#39;</span>
<span class="sd"> fname_wlssarimax = &#39;../../examples/saved/wlssarimax-sample.pickle&#39;</span>

<span class="sd"> # Save</span>
<span class="sd"> wlsarima.save(fname=fname_wlsarima)</span>
<span class="sd"> # wlssarimax.save(fname=fname_wlssarimax) (zstatespace can&#39;t be pickled)</span>

<span class="sd"> # Load</span>
<span class="sd"> wlsarima = WLSARMAWrapper().load(fname=fname_wlsarima)</span>
<span class="sd"> # wlssarimax = WLSARMAWrapper().load(fname=fname_wlssarimax)</span>

<span class="sd"> # -----------------</span>
<span class="sd"> #  Predictions</span>
<span class="sd"> # -----------------</span>
<span class="sd"> # Variables.</span>
<span class="sd"> start, end = None, None</span>

<span class="sd"> # Compute predictions.</span>
<span class="sd"> preds_wls = wlsarima.get_prediction(start=start, end=end, ptype=&#39;wls&#39;)</span>
<span class="sd"> preds_arima = wlsarima.get_prediction(start=start, end=end, ptype=&#39;arma&#39;)</span>
<span class="sd"> preds_sarimax = wlssarimax.get_prediction(start=start, end=end, ptype=&#39;arma&#39;)</span>
<span class="sd"> preds_wlsarima = wlsarima.get_prediction(start=start, end=end)</span>
<span class="sd"> preds_wlssarimax = wlssarimax.get_prediction(start=start, end=end)</span>
<span class="sd"> preds_sarimax = sarimax.get_prediction(start=start, end=end)</span>

<span class="sd"> # Create figures.</span>
<span class="sd"> fig, axes = plt.subplots(1, 2, figsize=(10, 4))</span>

<span class="sd"> # Subplot 0</span>
<span class="sd"> # ---------</span>
<span class="sd"> # Plot observed values</span>
<span class="sd"> endog = getattr(wlsarima._wls, &#39;endog&#39;)</span>
<span class="sd"> exog = getattr(wlsarima._wls, &#39;exog&#39;)[:, 1]</span>
<span class="sd"> axes[0].plot(exog, endog, color=&#39;#A6CEE3&#39;, alpha=0.5, marker=&#39;o&#39;,</span>
<span class="sd">              markeredgecolor=&#39;k&#39;, markeredgewidth=0.5,</span>
<span class="sd">              markersize=5, linewidth=0.75, label=&#39;Observed&#39;)</span>

<span class="sd"> # Plot forecasted values (WLS-ARIMA).</span>
<span class="sd"> axes[0].plot(preds_wlsarima[0, :], preds_wlsarima[1, :], color=&#39;#39ac73&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=wlsarima._identifier(short=True))</span>

<span class="sd"> # Plot confidence intervals (WLS-ARIMA)</span>
<span class="sd"> axes[0].fill_between(preds_wlsarima[0, 3:],</span>
<span class="sd">                      preds_wlsarima[2, 3:],</span>
<span class="sd">                      preds_wlsarima[3, 3:],</span>
<span class="sd">                      color=&#39;#39ac73&#39;, alpha=0.1)</span>

<span class="sd"> # Plot forecasted values (WLS-SARIMAX).</span>
<span class="sd"> axes[0].plot(preds_wlssarimax[0, :], preds_wlssarimax[1, :], color=&#39;b&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=wlssarimax._identifier(short=True))</span>

<span class="sd"> # Plot confidence intervals (WLS-SARIMAX)</span>
<span class="sd"> axes[0].fill_between(preds_wlssarimax[0, 3:],</span>
<span class="sd">                      preds_wlssarimax[2, 3:],</span>
<span class="sd">                      preds_wlssarimax[3, 3:],</span>
<span class="sd">                      color=&#39;b&#39;, alpha=0.1)</span>

<span class="sd"> # Plot forecasted values and confidence intervals (SARIMAX).</span>
<span class="sd"> axes[0].plot(preds_sarimax[0, :], preds_sarimax[1, :], color=&#39;#FF0000&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=sarimax._identifier())</span>

<span class="sd"> # Plot confidence intervals</span>
<span class="sd"> axes[0].fill_between(preds_sarimax[0, 3:],</span>
<span class="sd">                      preds_sarimax[2, 3:],</span>
<span class="sd">                      preds_sarimax[3, 3:],</span>
<span class="sd">                      color=&#39;#FF0000&#39;, alpha=0.1)</span>

<span class="sd"> # Subplot 1</span>
<span class="sd"> # ---------</span>
<span class="sd"> # Plot observed values.</span>
<span class="sd"> axes[1].plot(x, y, color=&#39;#A6CEE3&#39;, alpha=0.5, marker=&#39;o&#39;,</span>
<span class="sd">              markeredgecolor=&#39;k&#39;, markeredgewidth=0.5,</span>
<span class="sd">              markersize=5, linewidth=0.75, label=&#39;Observed&#39;)</span>

<span class="sd"> # Plot wls separately.</span>
<span class="sd"> axes[1].plot(preds_wls[0, :], preds_wls[1, :], color=&#39;#39ac73&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=wlsarima._wls._identifier(short=True))</span>

<span class="sd"> axes[1].fill_between(preds_wls[0, :],</span>
<span class="sd">                      preds_wls[2, :],</span>
<span class="sd">                      preds_wls[3, :],</span>
<span class="sd">                      color=&#39;#39ac73&#39;, alpha=0.1)</span>

<span class="sd"> # Plot arma separately.</span>
<span class="sd"> axes[1].plot(preds_arima[0, :], preds_arima[1, :], color=&#39;#FF0000&#39;,</span>
<span class="sd">              alpha=0.95, marker=&#39;o&#39;, markersize=2, linewidth=1.0,</span>
<span class="sd">              markeredgewidth=0.2, markeredgecolor=&#39;k&#39;,</span>
<span class="sd">              label=wlsarima._arma._identifier())</span>

<span class="sd"> axes[1].fill_between(preds_arima[0, :],</span>
<span class="sd">                      preds_arima[2, :],</span>
<span class="sd">                      preds_arima[3, :],</span>
<span class="sd">                      color=&#39;#FF0000&#39;, alpha=0.1)</span>

<span class="sd"> # Grid</span>
<span class="sd"> axes[0].grid(linestyle=&#39;--&#39;, linewidth=0.35, alpha=0.5)</span>
<span class="sd"> axes[1].grid(linestyle=&#39;--&#39;, linewidth=0.35, alpha=0.5)</span>

<span class="sd"> # Legend</span>
<span class="sd"> axes[0].legend()</span>
<span class="sd"> axes[1].legend()</span>

<span class="sd"> # Show</span>
<span class="sd"> plt.show()</span>
<span class="sd"> &quot;&quot;&quot;</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-tutorial-regression-plot-core-regression-ensemble-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/b9fb5039acf3355e3556b2f35325bee0/plot_core_regression_ensemble.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_core_regression_ensemble.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/897ed950bc8ccff6ffc203f0d07f7577/plot_core_regression_ensemble.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_core_regression_ensemble.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plot_core_regression_sarimax.html" class="btn btn-neutral float-right" title="Regression - SARIMAX" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="plot_core_regression_arima.html" class="btn btn-neutral float-left" title="Regression - ARIMA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Bernard Hernandez.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>